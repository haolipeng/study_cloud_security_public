时间：为期三个月

## 学习计划

# 第一个月：基础使用与概念理解

## **第 1 周：环境搭建与基础使用**

- 搭建 Tracee 运行环境（Ubuntu/Debian 系统）
- 了解 Tracee 的基本命令和参数
- 使用 `tracee` 监控系统基本事件
- 学习 eBPF 基础概念



## **第 2 周：基础安全监控实验**

- 实验一：使用 Tracee 监控文件操作（创建、删除、修改）
- 实验二：监控网络连接和数据传输
- 实验三：监控进程创建和执行
- 学习如何分析 Tracee 的输出日志



## **第 3 周：高级使用与策略配置**

- 学习 Tracee 的过滤器和选择器使用
- 实验四：配置自定义监控策略
- 实验五：检测特定类型的安全事件（如权限提升）
- 学习使用 Tracee 的 JSON 输出进行数据处理



## **第 4 周：集成与实际环境应用**

- 实验六：将 Tracee 集成到现有安全监控系统
- 实验七：模拟攻击场景，观察 Tracee 监控效果
- 学习 Tracee 与其他安全工具的配合使用
- 总结使用阶段经验，准备源码学习



# 第二个月：源码初探与基础功能理解

## **第 1 周：源码结构与开发环境**

- 克隆 Tracee 代码库，熟悉目录结构
- 搭建开发环境，确保能够编译 Tracee
- 阅读项目文档，了解架构设计
- 任务：实现简单的编译和运行自定义 Tracee 版本



## **第 2 周：核心组件学习**

- 学习 Tracee 的核心事件捕获机制
- 分析 eBPF 程序加载和挂载流程
- 理解事件处理管道架构
- 任务：修改一个简单的事件处理逻辑



## **第 3 周：事件处理与输出机制**

- 学习事件过滤器的实现
- 分析输出格式化和处理逻辑
- 理解事件元数据处理机制
- 任务：添加一个新的事件输出格式或字段



## **第 4 周：eBPF 程序分析**

- 深入学习 Tracee 中的 eBPF 程序代码
- 理解内核探针的实现方式
- 分析数据采集和传输机制
- 任务：修改一个现有的 eBPF 程序以捕获额外信息



# 第三个月：高级实践与 Rootkit 防御实验

## **第 1 周：内核 Hook 检测实验**

- 实验八：使用 Tracee 检测系统调用表钩子
  - 设计一个简单的系统调用 hook 测试样本
  - 配置 Tracee 检测系统调用表修改行为
  - 分析 Tracee 如何通过 eBPF 检测内核函数修改
- 实验九：检测内核模块隐藏技术
  - 模拟 LKM rootkit 的隐藏技术
  - 使用 Tracee 检测模块加载和卸载异常
  - 分析结果并改进检测方法

## **第 2 周：进程和文件隐藏检测实验**

- 实验十：检测进程隐藏技术
  - 构建一个使用 DKOM 技术隐藏进程的简单 rootkit
  - 使用 Tracee 监控进程表操作和异常
  - 对比 Tracee 与传统工具的检测效果
- 实验十一：检测文件系统篡改
  - 实现基本的文件系统 hook 隐藏文件
  - 配置 Tracee 监控 VFS 层操作
  - 分析 Tracee 如何检测文件系统篡改行为

## **第 3 周：网络和内存 Rootkit 检测实验**

- 实验十二：检测网络流量劫持
  - 实现一个简单的网络 hook rootkit
  - 使用 Tracee 监控网络栈操作
  - 分析网络异常行为的检测技术
- 实验十三：检测内存注入和修改
  - 构建一个内存操作型 rootkit
  - 配置 Tracee 监控内存映射和保护更改
  - 分析内存相关攻击的检测方法

## **第 4 周：高级 Rootkit 检测与防御策略**

- 实验十四：检测持久化和启动项修改
  - 分析各种 rootkit 持久化技术
  - 使用 Tracee 监控启动配置文件和服务
  - 建立持久化行为检测策略
- 实验十五：综合 Rootkit 检测实验
  - 设计一个具有多种隐藏技术的综合性 rootkit
  - 配置 Tracee 的综合检测策略
  - 评估检测效果并分析漏检原因
- 总结 Tracee 在 Rootkit 检测中的优势和局限



# 详细实验设计（特别是 Rootkit 检测部分）

## 实验八：系统调用表钩子检测

**目标**：了解 Tracee 如何检测系统调用表的修改，这是最常见的 rootkit 技术之一

**准备工作**：

- 准备一个可控的测试环境（虚拟机或容器）
- 编写一个简单的内核模块，用于修改系统调用表

**实验步骤**：

1、启动 Tracee 监控系统调用表相关事件：

```
sudo tracee --output json --events xxx
```

2、加载测试内核模块修改系统调用表：

3、分析 Tracee 的检测日志，关注系统调用表地址变化

4、尝试修改不同的系统调用，观察 Tracee 的检测效果

5、对比 Tracee 与传统的 rootkit 检测工具（如 rkhunter）的检测效果



## 实验九：内核模块隐藏检测

**目标**：了解 Tracee 如何检测隐藏的内核模块，这是 rootkit 的常见隐身技术

**准备工作**：

- 编写一个测试内核模块，模拟从模块列表中隐藏自己

**实验步骤**：

1. 启动 Tracee 监控内核模块相关事件
2. 加载并触发模块隐藏行为
3. 使用 `lsmod` 确认模块已从列表中隐藏
4. 分析 Tracee 的检测日志，观察是否能检测到模块存在的痕迹
5. 测试 Tracee 检测其他模块隐藏技术（如修改 /proc/modules）的效果



## 实验十：进程隐藏检测

**目标**：了解 Tracee 如何检测使用 DKOM（Direct Kernel Object Manipulation）技术隐藏的进程

**准备工作**：

- 编写或获取一个简单的进程隐藏 rootkit 示例
- 准备一个测试进程用于隐藏

**实验步骤**：

1. 启动 Tracee 监控进程相关事件
2. 启动测试进程并记录 PID
3. 使用 rootkit 工具隐藏该进程
4. 使用 `ps` 确认进程已被隐藏
5. 分析 Tracee 的检测日志，观察是否能检测到进程活动的痕迹
6. 评估 Tracee 检测隐藏进程的能力和局限性



### 实验十一：文件系统篡改检测

**目标**：了解 Tracee 如何检测文件系统劫持行为，这是 rootkit 隐藏文件和后门的常用技术

**准备工作**：

- 编写一个简单的文件系统 hook 测试模块
- 准备测试文件和目录

**实验步骤**：

1. 启动 Tracee 监控文件系统相关事件
2. 创建测试文件
3. 加载文件系统 hook 模块
4. 尝试列出目录和查看文件内容
5. 分析 Tracee 的检测日志，关注文件系统操作的异常行为
6. 评估 Tracee 检测文件系统 hook 的能力和限制



### 实验十二：网络流量劫持检测

**目标**：了解 Tracee 如何检测网络栈劫持，这是 rootkit 劫持网络通信的常用技术

**准备工作**：

- 编写一个简单的网络 hook 测试模块（修改 netfilter 或网络协议栈函数）
- 准备测试网络服务

**实验步骤**：

1. 启动 Tracee 监控网络相关事件
2. 开启一个测试网络服务
3. 加载网络 hook 模块
4. 向测试服务发送数据
5. 分析 Tracee 的检测日志，关注网络数据流的异常行为
6. 评估 Tracee 检测网络劫持的能力和限制



### 实验十三：Rootkit 持久化检测

**目标**：了解 Tracee 如何检测 rootkit 的持久化机制

**准备工作**：

- 准备多种持久化方法的测试脚本（systemd 服务、启动脚本、crontab 等）

**实验步骤**：

1. 启动 Tracee 监控文件系统和进程相关事件
2. 执行各种持久化操作
3. 分析 Tracee 的检测日志，关注配置文件修改和敏感目录访问
4. 重启系统，检查 Tracee 是否能检测到持久化组件的运行
5. 评估 Tracee 检测不同持久化方法的能力和限制



# 原理解析篇：高级实践与 Rootkit 防御实验

## **第 1 周：内核 Hook 检测实验**

#### 实验八：系统调用表钩子检测

**实验步骤**：

1. 启动 Tracee 监控系统调用表相关事件
2. 加载测试内核模块修改系统调用表
3. 分析 Tracee 的检测日志，关注系统调用表地址变化
4. 尝试修改不同的系统调用，观察 Tracee 的检测效果
5. 对比 Tracee 与传统的 rootkit 检测工具的检测效果

**原理解析环节**：

- 分析 Tracee 源码中系统调用表检测的关键部分（位于 `pkg/ebpf/c/tracee.bpf.c` 中的系统调用表监控相关代码）
- 理解 Tracee 如何使用 eBPF 程序监控内核内存区域
- 研究 Tracee 如何建立系统调用表的基准并检测偏差
- 分析 Tracee 检测系统调用表修改的技术限制和可能的绕过方法
- 学习 eBPF 如何安全地访问内核数据结构而不破坏系统稳定性

**原理讨论问题**：

1. Tracee 如何在不修改内核的情况下监控系统调用表？
2. 为什么某些系统调用修改可能被检测，而其他可能被遗漏？
3. Tracee 的检测机制与传统的内存扫描技术有何不同？

#### 实验九：内核模块隐藏检测

**实验步骤**：

1. 启动 Tracee 监控内核模块相关事件
2. 加载并触发模块隐藏行为
3. 使用 `lsmod` 确认模块已从列表中隐藏
4. 分析 Tracee 的检测日志
5. 测试 Tracee 检测其他模块隐藏技术的效果

**原理解析环节**：

- 分析 Tracee 如何通过 kprobes/tracepoints 捕获模块加载和卸载事件
- 研究 Tracee 如何监控模块列表修改操作
- 理解 Tracee 对内核函数 `module_get_kallsyms`、`module_get_iter_list` 等的 hook 机制
- 分析 Tracee 如何检测模块列表与实际加载模块的不一致
- 学习如何通过 eBPF 程序访问和验证内核模块列表的完整性

**原理讨论问题**：

1. Linux 内核如何管理模块列表，Tracee 如何利用这一机制进行检测？
2. Tracee 是否能检测所有类型的模块隐藏技术？为什么？
3. eBPF 的安全限制如何影响 Tracee 对隐藏模块的检测能力？

## **第 2 周：进程和文件隐藏检测实验**

#### 实验十：进程隐藏检测

**实验步骤**：

1. 启动 Tracee 监控进程相关事件
2. 启动测试进程并记录 PID
3. 使用 rootkit 工具隐藏该进程
4. 使用 `ps` 确认进程已被隐藏
5. 分析 Tracee 的检测日志
6. 评估 Tracee 检测隐藏进程的能力和局限性

**原理解析环节**：

- 分析 Tracee 如何通过 tracepoints 跟踪进程创建和终止
- 研究 Tracee 对任务结构和进程列表的监控方法
- 理解 Tracee 如何建立进程基线并检测异常
- 分析 Tracee 如何检测 DKOM（Direct Kernel Object Manipulation）技术
- 学习 Tracee 对 `/proc` 文件系统操作的监控原理

**原理讨论问题**：

1. Linux 内核如何管理进程列表，Tracee 如何检测其异常？
2. 进程隐藏技术的核心原理是什么，Tracee 如何应对不同的隐藏方法？
3. Tracee 的检测相比传统进程枚举方法有何优势和局限性？

#### 实验十一：文件系统篡改检测

**实验步骤**：

1. 启动 Tracee 监控文件系统相关事件
2. 创建测试文件
3. 加载文件系统 hook 模块
4. 尝试列出目录和查看文件内容
5. 分析 Tracee 的检测日志
6. 评估 Tracee 检测文件系统 hook 的能力和限制

**原理解析环节**：

- 分析 Tracee 如何监控 VFS（虚拟文件系统）层操作
- 研究 Tracee 对文件系统相关系统调用的跟踪机制
- 理解 Tracee 如何检测文件系统函数被 hook 的情况
- 分析 Tracee 如何检测文件内容与文件系统元数据的不一致
- 学习 Tracee 如何通过多层比对发现文件隐藏行为

**原理讨论问题**：

1. Linux VFS 层的工作原理，以及 Tracee 如何利用它来检测异常？
2. 文件系统 hook 技术的核心原理是什么，为什么能够隐藏文件？
3. Tracee 在文件系统监控上有哪些技术限制，如何改进检测能力？

## **第 3 周：网络和内存 Rootkit 检测实验**

#### 实验十二：网络流量劫持检测

**实验步骤**：

1. 启动 Tracee 监控网络相关事件
2. 开启一个测试网络服务
3. 加载网络 hook 模块
4. 向测试服务发送数据
5. 分析 Tracee 的检测日志
6. 评估 Tracee 检测网络劫持的能力和限制

**原理解析环节**：

- 分析 Tracee 如何监控网络协议栈操作
- 研究 Tracee 对网络相关系统调用和内核函数的跟踪
- 理解 Tracee 如何检测 netfilter hook 和协议栈修改
- 分析 Tracee 如何识别网络数据流的异常行为
- 学习 Tracee 对比应用层和内核层网络事件的方法

**原理讨论问题**：

1. Linux 网络栈的工作原理，Tracee 如何在各层进行监控？
2. 网络劫持技术通常使用哪些内核机制，Tracee 如何检测它们？
3. Tracee 在网络监控上的覆盖范围和盲点是什么？

#### 实验十三：内存注入检测

**实验步骤**：

1. 启动 Tracee 监控内存相关事件
2. 启动测试进程
3. 执行内存注入
4. 分析 Tracee 的检测日志
5. 评估 Tracee 检测内存注入的能力和限制

**原理解析环节**：

- 分析 Tracee 如何监控进程内存操作
- 研究 Tracee 对内存映射和保护变更的跟踪方法
- 理解 Tracee 如何检测跨进程内存访问（如 ptrace）
- 分析 Tracee 如何识别可疑的代码注入模式
- 学习 Tracee 对可执行内存区域的监控原理

**原理讨论问题**：

1. Linux 内存管理机制的工作原理，Tracee 如何利用它进行检测？
2. 内存注入技术的核心方法有哪些，Tracee 分别如何检测？
3. eBPF 的限制如何影响 Tracee 对内存操作的监控能力？

## **第 4 周：高级 Rootkit 检测与防御策略**

#### 实验十四：Rootkit 持久化检测

**实验步骤**：

1. 启动 Tracee 监控文件系统和进程相关事件
2. 执行各种持久化操作
3. 分析 Tracee 的检测日志
4. 重启系统，检查 Tracee 是否能检测到持久化组件的运行
5. 评估 Tracee 检测不同持久化方法的能力和限制

**原理解析环节**：

- 分析 Tracee 如何监控系统配置文件的修改
- 研究 Tracee 对启动过程和服务管理的监控方法
- 理解 Tracee 如何检测异常的特权操作和配置更改
- 分析 Tracee 如何识别可疑的持久化行为模式
- 学习 Tracee 如何通过事件关联发现高级持久化技术

**原理讨论问题**：

1. Linux 系统启动和服务管理的工作原理，Tracee 如何监控它们？
2. 不同持久化技术的实现机制，Tracee 如何检测各种变体？
3. Tracee 在持久化检测上的优势和局限性是什么？