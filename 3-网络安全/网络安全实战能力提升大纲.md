# ç½‘ç»œå®‰å…¨å®æˆ˜èƒ½åŠ›æå‡å¤§çº²ï¼ˆå·¥ç¨‹åŒ–è½åœ°ç‰ˆï¼‰

> é¢å‘æœ‰5å¹´ç»éªŒçš„ç½‘ç»œå®‰å…¨ç¨‹åºå‘˜ï¼Œèšç„¦å·¥ç¨‹åŒ–è½åœ°ä¸å•†ä¸šåŒ–
> æ ¸å¿ƒæŠ€æœ¯æ ˆï¼šGolang + Kafka + ClickHouse + React

---

## ä¸€ã€ç½‘ç»œæµé‡åˆ†ææ ¸å¿ƒæŠ€æœ¯

### 1.1 æµé‡é‡‡é›†ä¸å¤„ç†

#### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **åº•å±‚æŠ“åŒ…**ï¼šlibpcapã€AF_PACKETã€PF_RINGã€DPDK
- **é›¶æ‹·è´æŠ€æœ¯**ï¼šå‡å°‘æ•°æ®æ‹·è´æ¬¡æ•°ï¼Œæå‡æ€§èƒ½
- **æµé‡é•œåƒæ–¹æ¡ˆ**ï¼šSPANï¼ˆäº¤æ¢æœºç«¯å£é•œåƒï¼‰ã€TAPï¼ˆç‰©ç†åˆ†æµï¼‰

#### æ¶æ„è®¾è®¡
```
[æµé‡é•œåƒç‚¹] â†’ [é‡‡é›†Agent] â†’ [æœ¬åœ°ç¼“å†²] â†’ [Kafkaæ¶ˆæ¯é˜Ÿåˆ—] â†’ [åˆ†æé›†ç¾¤]
```

#### æ ¸å¿ƒæ¨¡å—è®¾è®¡

**1. é‡‡é›†Agentæ¨¡å—**
```go
// åŒ…ç»“æ„
package collector

// æ ¸å¿ƒæ¥å£
type PacketCapturer interface {
    Start(interfaceName string) error
    Stop() error
    GetStats() CaptureStats
}

type PacketProcessor interface {
    Process(packet *Packet) error
    SetFilters(filters []BPFFilter) error
}

// æ ¸å¿ƒç»“æ„ä½“
type CaptureAgent struct {
    config      *CaptureConfig
    capturer    PacketCapturer
    processor   PacketProcessor
    buffer      *RingBuffer
    kafkaWriter *KafkaProducer
}

// ä¸»è¦å‡½æ•°
func NewCaptureAgent(config *CaptureConfig) *CaptureAgent
func (a *CaptureAgent) Start() error
func (a *CaptureAgent) Stop() error
func (a *CaptureAgent) HandlePacket(packet *Packet)
func (a *CaptureAgent) FlushToKafka() error
```

**2. é…ç½®ç®¡ç†æ¨¡å—**
```go
package config

type CaptureConfig struct {
    Interface      string
    SnapLen        int
    BufferSize     int
    BPFFilter      string
    KafkaBrokers   []string
    KafkaTopic     string
    BatchSize      int
    FlushInterval  time.Duration
}

func LoadConfig(path string) (*CaptureConfig, error)
func (c *CaptureConfig) Validate() error
```

**3. æ€§èƒ½ç›‘æ§æ¨¡å—**
```go
package monitor

type CaptureStats struct {
    PacketsReceived   uint64
    PacketsDropped    uint64
    BytesReceived     uint64
    CPUUsage          float64
    MemoryUsage       uint64
}

type Monitor struct {
    statsCollector *StatsCollector
    metricsExporter *PrometheusExporter
}

func (m *Monitor) CollectStats() *CaptureStats
func (m *Monitor) ReportToPrometheus()
func (m *Monitor) CheckHealth() HealthStatus
```

#### å·¥ç¨‹åŒ–è¦ç‚¹
- 10Gbps+ ç½‘ç»œç¯å¢ƒçš„æŠ“åŒ…ä¼˜åŒ–
- æ•°æ®åŒ…ä¸¢å¤±ç›‘æ§ä¸å‘Šè­¦
- Agentç«¯çš„æ–­çº¿é‡è¿æœºåˆ¶
- æµé‡é‡‡æ ·ç­–ç•¥ï¼ˆå…¨é‡/æŠ½æ ·ï¼‰

#### å¼€æºé¡¹ç›®å‚è€ƒ
- **Moloch/Arkime**ï¼šå¤§è§„æ¨¡æµé‡å­˜å‚¨ä¸æ£€ç´¢
- **ntopng**ï¼šå®æ—¶ç½‘ç»œæµé‡ç›‘æ§

---

### 1.2 æ·±åº¦åŒ…æ£€æµ‹ï¼ˆDPIï¼‰å¼•æ“

#### æ ¸å¿ƒæŠ€æœ¯
- **åè®®è¯†åˆ«**ï¼šåŸºäºç«¯å£ã€ç‰¹å¾ç ã€è¡Œä¸ºæ¨¡å¼
- **åè®®è§£æ**ï¼šHTTP/HTTPS/DNS/TLS/ç­‰
- **æµé‡è¿˜åŸ**ï¼šTCPæµé‡ç»„ã€æ–‡ä»¶æå–
- **åŠ å¯†æµé‡åˆ†æ**ï¼šTLSæŒ‡çº¹ï¼ˆJA3/JA3Sï¼‰ã€SNIæå–

#### æ¶æ„è®¾è®¡
```
[åŸå§‹æ•°æ®åŒ…] â†’ [åè®®è¯†åˆ«] â†’ [åè®®è§£æå™¨] â†’ [å…ƒæ•°æ®æå–] â†’ [ç»“æ„åŒ–å­˜å‚¨]
                    â†“
              [æµé‡ç»„å¼•æ“] â†’ [æ–‡ä»¶æå–] â†’ [å¯¹è±¡å­˜å‚¨]
```

#### æ ¸å¿ƒæ¨¡å—è®¾è®¡

**1. åè®®è¯†åˆ«æ¨¡å—**
```go
package dpi

type ProtocolIdentifier interface {
    Identify(packet *Packet) Protocol
    RegisterPlugin(plugin ProtocolPlugin)
}

type nDPIIntegration struct {
    ndpiHandle *nDPI.Handle
}

func NewProtocolIdentifier() ProtocolIdentifier
func (p *nDPIIntegration) Identify(packet *Packet) Protocol
func (p *nDPIIntegration) GetApplicationName(flowID FlowID) string
```

**2. åè®®è§£ææ¨¡å—**
```go
package parser

type ProtocolParser interface {
    Parse(data []byte) (Metadata, error)
    GetProtocolName() string
}

// HTTPè§£æå™¨
type HTTPParser struct {
    config *ParserConfig
}

func (p *HTTPParser) Parse(data []byte) (*HTTPMetadata, error)
func (p *HTTPParser) ExtractHeaders(req *http.Request) map[string]string
func (p *HTTPParser) ExtractCookies(req *http.Request) []Cookie

// DNSè§£æå™¨
type DNSParser struct{}
func (p *DNSParser) Parse(data []byte) (*DNSMetadata, error)

// TLSè§£æå™¨
type TLSParser struct{}
func (p *TLSParser) Parse(data []byte) (*TLSMetadata, error)
func (p *TLSParser) ExtractJA3(clientHello *tls.ClientHello) string
```

**3. æµé‡ç»„å¼•æ“**
```go
package reassembly

type StreamReassembler struct {
    flows         map[FlowID]*FlowState
    timeout       time.Duration
    maxFlowSize   int64
}

type FlowState struct {
    FlowID        FlowID
    ClientSeq     map[uint32]*Packet
    ServerSeq     map[uint32]*Packet
    ReassembledData []byte
}

func NewStreamReassembler() *StreamReassembler
func (r *StreamReassembler) ProcessPacket(packet *Packet) error
func (r *StreamReassembler) ReassembleFlow(flowID FlowID) ([]byte, error)
func (r *StreamReassembler) CleanupExpiredFlows()
```

**4. æ–‡ä»¶æå–æ¨¡å—**
```go
package extraction

type FileExtractor interface {
    Extract(data []byte) (*ExtractedFile, error)
    SupportedProtocols() []Protocol
}

type HTTPFileExtractor struct {
    maxFileSize int64
    storage     ObjectStorage
}

type ExtractedFile struct {
    Protocol    Protocol
    Filename    string
    ContentType string
    Size        int64
    MD5         string
    SHA256      string
    Data        []byte
}

func (e *HTTPFileExtractor) Extract(httpStream []byte) (*ExtractedFile, error)
func (e *HTTPFileExtractor) SaveToStorage(file *ExtractedFile) (string, error)
```

#### å…ƒæ•°æ®ç»“æ„å®šä¹‰
```go
package metadata

type HTTPMetadata struct {
    Timestamp     time.Time
    SrcIP         string
    DstIP         string
    Method        string
    Host          string
    URI           string
    UserAgent     string
    StatusCode    int
    ContentLength int64
    Headers       map[string]string
}

type DNSMetadata struct {
    Timestamp     time.Time
    QueryName     string
    QueryType     string
    ResponseCode  string
    Answers       []string
    TTL           int
}

type TLSMetadata struct {
    Timestamp     time.Time
    SNI           string
    JA3           string
    JA3S          string
    CipherSuite   string
    TLSVersion    string
    Certificates  []string
}
```

#### å·¥ç¨‹åŒ–è¦ç‚¹
- åè®®è§£æå™¨çš„æ’ä»¶åŒ–è®¾è®¡
- å†…å­˜ä½¿ç”¨æ§åˆ¶ï¼ˆå¤§æµé‡åœºæ™¯ï¼‰
- è§£ææ€§èƒ½ä¼˜åŒ–ï¼ˆå¹¶å‘å¤„ç†ï¼‰
- é›†æˆnDPIå¼€æºåº“

#### å¼€æºé¡¹ç›®å‚è€ƒ
- **Zeek (Bro)**ï¼šå¼ºå¤§çš„æµé‡åˆ†ææ¡†æ¶
- **nDPI**ï¼šåè®®è¯†åˆ«åº“
- **gopacket**ï¼šGoè¯­è¨€åŒ…è§£æåº“

---

### 1.3 æµé‡ç‰¹å¾æå–ä¸åˆ†æ

#### æ ¸å¿ƒæŠ€æœ¯
- **NetFlow/IPFIX**ï¼šæµé‡å…ƒæ•°æ®ç”Ÿæˆ
- **ä¼šè¯ç»Ÿè®¡**ï¼šè¿æ¥æ•°ã€å­—èŠ‚æ•°ã€åŒ…æ•°ç»Ÿè®¡
- **è¡Œä¸ºåŸºçº¿**ï¼šæ­£å¸¸æµé‡æ¨¡å‹å»ºç«‹
- **å¼‚å¸¸æ£€æµ‹**ï¼šç»Ÿè®¡å­¦æ–¹æ³•ã€æ—¶åºåˆ†æ

#### æ¶æ„è®¾è®¡
```
[åŸå§‹æµé‡] â†’ [æµé‡èšåˆ] â†’ [ç‰¹å¾è®¡ç®—] â†’ [åŸºçº¿å»ºæ¨¡] â†’ [å¼‚å¸¸æ£€æµ‹]
                                â†“
                           [ç‰¹å¾å­˜å‚¨(ClickHouse)]
```

#### æ ¸å¿ƒæ¨¡å—è®¾è®¡

**1. NetFlowç”Ÿæˆæ¨¡å—**
```go
package netflow

type FlowExporter struct {
    flows         map[FlowKey]*Flow
    exportInterval time.Duration
    kafkaProducer *KafkaProducer
}

type Flow struct {
    FlowKey
    StartTime     time.Time
    EndTime       time.Time
    PacketCount   uint64
    ByteCount     uint64
    TCPFlags      uint8
    Protocol      uint8
}

type FlowKey struct {
    SrcIP    string
    DstIP    string
    SrcPort  uint16
    DstPort  uint16
    Protocol uint8
}

func NewFlowExporter() *FlowExporter
func (e *FlowExporter) UpdateFlow(packet *Packet)
func (e *FlowExporter) ExportFlows() error
func (e *FlowExporter) GenerateNetFlowV9() []byte
```

**2. æµé‡ç‰¹å¾åˆ†ç±»ä½“ç³»**

æµé‡ç‰¹å¾æ˜¯å¨èƒæ£€æµ‹çš„åŸºç¡€ï¼Œä»¥ä¸‹æ˜¯å®Œæ•´çš„ç‰¹å¾åˆ†ç±»å’Œæ•°æ®ç»“æ„å®šä¹‰ï¼š

##### 2.1 åŸºç¡€ç»Ÿè®¡ç‰¹å¾ï¼ˆFlow-levelï¼‰
```go
package features

type BasicFlowFeatures struct {
    // æ•°é‡ç‰¹å¾
    PacketCount       int64   // åŒ…æ•°é‡
    ByteCount         int64   // å­—èŠ‚æ•°
    ForwardPackets    int64   // æ­£å‘åŒ…æ•°
    BackwardPackets   int64   // åå‘åŒ…æ•°
    ForwardBytes      int64   // æ­£å‘å­—èŠ‚æ•°
    BackwardBytes     int64   // åå‘å­—èŠ‚æ•°
    
    // æ—¶é•¿ç‰¹å¾
    Duration          float64 // æµæŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
    FlowRate          float64 // æµé‡é€Ÿç‡ï¼ˆbytes/sï¼‰
    PacketRate        float64 // åŒ…é€Ÿç‡ï¼ˆpackets/sï¼‰
    
    // åŒ…é•¿ç‰¹å¾
    MinPacketLength   int     // æœ€å°åŒ…é•¿
    MaxPacketLength   int     // æœ€å¤§åŒ…é•¿
    MeanPacketLength  float64 // å¹³å‡åŒ…é•¿
    StdPacketLength   float64 // åŒ…é•¿æ ‡å‡†å·®
    
    // æ–¹å‘æ€§ç‰¹å¾
    ForwardMinPktLen  int
    ForwardMaxPktLen  int
    ForwardMeanPktLen float64
    BackwardMinPktLen int
    BackwardMaxPktLen int
    BackwardMeanPktLen float64
}

// åº”ç”¨åœºæ™¯ï¼š
// - DDoSæ£€æµ‹ï¼ˆå¤§é‡å°åŒ…/å¤§æµé‡ï¼‰
// - æ‰«ææ£€æµ‹ï¼ˆå¤§é‡å°åŒ…ã€å•å‘æµé‡ï¼‰
// - æ•°æ®æ³„éœ²ï¼ˆå¤§é‡ä¸Šä¼ æµé‡ï¼‰
```

##### 2.2 æ—¶é—´ç‰¹å¾ï¼ˆTemporalï¼‰
```go
type TemporalFeatures struct {
    // åˆ°è¾¾é—´éš”ï¼ˆIAT - Inter-Arrival Timeï¼‰
    MeanIAT           float64 // å¹³å‡åˆ°è¾¾é—´éš”
    StdIAT            float64 // åˆ°è¾¾é—´éš”æ ‡å‡†å·®
    MinIAT            float64 // æœ€å°åˆ°è¾¾é—´éš”
    MaxIAT            float64 // æœ€å¤§åˆ°è¾¾é—´éš”
    
    ForwardMeanIAT    float64 // æ­£å‘å¹³å‡IAT
    ForwardStdIAT     float64
    BackwardMeanIAT   float64 // åå‘å¹³å‡IAT
    BackwardStdIAT    float64
    
    // æ´»åŠ¨æ—¶é—´åˆ†å¸ƒ
    ActiveMean        float64 // æ´»åŠ¨æœŸå¹³å‡æ—¶é•¿
    ActiveStd         float64
    ActiveMax         float64
    ActiveMin         float64
    
    IdleMean          float64 // ç©ºé—²æœŸå¹³å‡æ—¶é•¿
    IdleStd           float64
    IdleMax           float64
    IdleMin           float64
    
    // çªå‘ç‰¹å¾
    BurstRate         float64 // çªå‘é€Ÿç‡
    BurstDuration     float64 // çªå‘æŒç»­æ—¶é—´
}

// åº”ç”¨åœºæ™¯ï¼š
// - C2 Beaconæ£€æµ‹ï¼ˆè§„å¾‹æ€§å¿ƒè·³ï¼Œå›ºå®šé—´éš”ï¼‰
// - äººæœºè¯†åˆ«ï¼ˆäººç±»æ“ä½œä¸è§„å¾‹ï¼Œbotå¾ˆè§„å¾‹ï¼‰
// - æµåª’ä½“è¯†åˆ«ï¼ˆç¨³å®šçš„åŒ…åˆ°è¾¾é—´éš”ï¼‰
```

##### 2.3 TCPåè®®ç‰¹å¾
```go
type TCPFeatures struct {
    // TCP Flagsç»Ÿè®¡
    FINFlagCount      int // FINæ ‡å¿—æ•°é‡
    SYNFlagCount      int // SYNæ ‡å¿—æ•°é‡
    RSTFlagCount      int // RSTæ ‡å¿—æ•°é‡
    PSHFlagCount      int // PSHæ ‡å¿—æ•°é‡
    ACKFlagCount      int // ACKæ ‡å¿—æ•°é‡
    URGFlagCount      int // URGæ ‡å¿—æ•°é‡
    ECEFlagCount      int // ECEæ ‡å¿—æ•°é‡
    CWRFlagCount      int // CWRæ ‡å¿—æ•°é‡
    
    // TCPçª—å£ç‰¹å¾
    InitWindowSize    int     // åˆå§‹çª—å£å¤§å°
    MinWindowSize     int     // æœ€å°çª—å£
    MaxWindowSize     int     // æœ€å¤§çª—å£
    MeanWindowSize    float64 // å¹³å‡çª—å£
    
    // TCPé€‰é¡¹ç‰¹å¾
    MSS               int     // æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦
    WindowScale       int     // çª—å£æ‰©å¤§å› å­
    SACK              bool    // é€‰æ‹©æ€§ç¡®è®¤
    Timestamp         bool    // æ—¶é—´æˆ³é€‰é¡¹
    
    // é‡ä¼ ç‰¹å¾
    RetransmitCount   int     // é‡ä¼ æ¬¡æ•°
    RetransmitRate    float64 // é‡ä¼ ç‡
    
    // è¿æ¥ç‰¹å¾
    HandshakeTime     float64 // ä¸‰æ¬¡æ¡æ‰‹æ—¶é•¿ï¼ˆRTTä¼°ç®—ï¼‰
}

// åº”ç”¨åœºæ™¯ï¼š
// - ç«¯å£æ‰«æï¼ˆå¤§é‡SYN/RSTï¼‰
// - SYN Floodæ”»å‡»
// - æ“ä½œç³»ç»ŸæŒ‡çº¹è¯†åˆ«ï¼ˆTCP/IP stack fingerprintingï¼‰
// - ç½‘ç»œè´¨é‡åˆ†æï¼ˆé‡ä¼ ç‡ï¼‰
```

##### 2.4 åè®®åˆ†å¸ƒç‰¹å¾
```go
type ProtocolDistFeatures struct {
    // åº”ç”¨å±‚åè®®åˆ†å¸ƒ
    HTTPRatio         float64 // HTTPæµé‡å æ¯”
    HTTPSRatio        float64 // HTTPSæµé‡å æ¯”
    DNSRatio          float64 // DNSæµé‡å æ¯”
    SMBRatio          float64 // SMBæµé‡å æ¯”
    SSHRatio          float64 // SSHæµé‡å æ¯”
    FTPRatio          float64 // FTPæµé‡å æ¯”
    
    // ç«¯å£åˆ†å¸ƒç†µ
    SrcPortEntropy    float64 // æºç«¯å£ç†µå€¼
    DstPortEntropy    float64 // ç›®æ ‡ç«¯å£ç†µå€¼
    
    // åè®®å¤šæ ·æ€§
    ProtocolCount     int     // ä½¿ç”¨çš„åè®®ç§ç±»æ•°
    UniquePortCount   int     // è®¿é—®çš„å”¯ä¸€ç«¯å£æ•°
}

// åº”ç”¨åœºæ™¯ï¼š
// - å¼‚å¸¸æµé‡æ£€æµ‹ï¼ˆç†µå€¼å¼‚å¸¸ï¼‰
// - æ‰«ææ£€æµ‹ï¼ˆè®¿é—®å¤§é‡ç«¯å£ï¼‰
// - åè®®å¼‚å¸¸ï¼ˆéæ ‡å‡†ç«¯å£ä½¿ç”¨æ ‡å‡†åè®®ï¼‰
```

##### 2.5 TLS/SSLæŒ‡çº¹ç‰¹å¾
```go
type TLSFeatures struct {
    // JA3æŒ‡çº¹
    JA3Fingerprint    string  // å®¢æˆ·ç«¯TLSæŒ‡çº¹
    JA3SFingerprint   string  // æœåŠ¡ç«¯TLSæŒ‡çº¹
    
    // TLSè¯¦ç»†ä¿¡æ¯
    TLSVersion        string  // TLSç‰ˆæœ¬
    CipherSuite       string  // åŠ å¯†å¥—ä»¶
    SNI               string  // Server Name Indication
    
    // è¯ä¹¦ç‰¹å¾
    CertIssuer        string  // è¯ä¹¦é¢å‘è€…
    CertSubject       string  // è¯ä¹¦ä¸»é¢˜
    CertValidDays     int     // è¯ä¹¦æœ‰æ•ˆæœŸï¼ˆå¤©ï¼‰
    CertSelfSigned    bool    // æ˜¯å¦è‡ªç­¾å
    
    // æ¡æ‰‹ç‰¹å¾
    HandshakeBytes    int     // æ¡æ‰‹æ•°æ®é‡
    HandshakePackets  int     // æ¡æ‰‹åŒ…æ•°é‡
}

// åº”ç”¨åœºæ™¯ï¼š
// - æ¶æ„è½¯ä»¶è¯†åˆ«ï¼ˆç‰¹å®šçš„JA3æŒ‡çº¹ï¼‰
// - é’“é±¼ç½‘ç«™æ£€æµ‹ï¼ˆè‡ªç­¾åè¯ä¹¦ã€çŸ­æœ‰æ•ˆæœŸï¼‰
// - åŠ å¯†æµé‡åˆ†ç±»ï¼ˆä¸è§£å¯†å†…å®¹ä¹Ÿèƒ½è¯†åˆ«åº”ç”¨ï¼‰
```

##### 2.6 HTTPç‰¹å¾
```go
type HTTPFeatures struct {
    // è¯·æ±‚ç‰¹å¾
    Method            string    // è¯·æ±‚æ–¹æ³•
    URILength         int       // URIé•¿åº¦
    URIDepth          int       // URIè·¯å¾„æ·±åº¦
    URIParamCount     int       // URLå‚æ•°æ•°é‡
    
    // User-Agentç‰¹å¾
    UserAgent         string    // å®Œæ•´UA
    UAEntropy         float64   // UAç†µå€¼ï¼ˆæ£€æµ‹éšæœºUAï¼‰
    UALength          int       // UAé•¿åº¦
    
    // å¤´éƒ¨ç‰¹å¾
    HeaderCount       int       // å¤´éƒ¨å­—æ®µæ•°é‡
    HeaderOrder       string    // å¤´éƒ¨é¡ºåºæŒ‡çº¹
    ContentType       string    // å†…å®¹ç±»å‹
    ContentLength     int64     // å†…å®¹é•¿åº¦
    
    // å“åº”ç‰¹å¾
    StatusCode        int       // HTTPçŠ¶æ€ç 
    ResponseTime      float64   // å“åº”æ—¶é—´
    
    // è¡Œä¸ºç‰¹å¾
    RequestRate       float64   // è¯·æ±‚é¢‘ç‡
    ErrorRate         float64   // é”™è¯¯ç‡ï¼ˆ4xx/5xxï¼‰
}

// åº”ç”¨åœºæ™¯ï¼š
// - Webæ”»å‡»æ£€æµ‹ï¼ˆSQLæ³¨å…¥ã€XSSç­‰URIå¼‚å¸¸ï¼‰
// - çˆ¬è™«/Botæ£€æµ‹ï¼ˆUAå¼‚å¸¸ã€è¯·æ±‚é¢‘ç‡å¼‚å¸¸ï¼‰
// - C2é€šä¿¡æ£€æµ‹ï¼ˆå¼‚å¸¸çš„HTTPè¡Œä¸ºï¼‰
```

##### 2.7 DNSç‰¹å¾
```go
type DNSFeatures struct {
    // æŸ¥è¯¢ç‰¹å¾
    QueryType         string    // æŸ¥è¯¢ç±»å‹ï¼ˆA/AAAA/CNAME/TXTç­‰ï¼‰
    QueryName         string    // æŸ¥è¯¢åŸŸå
    QueryLength       int       // æŸ¥è¯¢é•¿åº¦
    
    // åŸŸåç‰¹å¾
    DomainEntropy     float64   // åŸŸåç†µå€¼ï¼ˆDGAæ£€æµ‹ï¼‰
    SubdomainCount    int       // å­åŸŸåæ•°é‡
    DomainLength      int       // åŸŸåé•¿åº¦
    DigitRatio        float64   // æ•°å­—å æ¯”
    VowelRatio        float64   // å…ƒéŸ³å æ¯”
    
    // å“åº”ç‰¹å¾
    ResponseCode      string    // å“åº”ç ï¼ˆNOERROR/NXDOMAINç­‰ï¼‰
    AnswerCount       int       // åº”ç­”è®°å½•æ•°
    TTL               int       // TTLå€¼
    
    // è¡Œä¸ºç‰¹å¾
    QueryRate         float64   // æŸ¥è¯¢é¢‘ç‡
    FailureRate       float64   // å¤±è´¥ç‡ï¼ˆNXDOMAINï¼‰
    UniqueDomainCount int       // å”¯ä¸€åŸŸåæ•°
}

// åº”ç”¨åœºæ™¯ï¼š
// - DGAåŸŸåæ£€æµ‹ï¼ˆç†µå€¼é«˜ã€éšæœºå­—ç¬¦ï¼‰
// - DNSéš§é“æ£€æµ‹ï¼ˆå¤§é‡TXTæŸ¥è¯¢ã€å¼‚å¸¸é•¿åŸŸåï¼‰
// - DNSåŠ«æŒæ£€æµ‹ï¼ˆTTLå¼‚å¸¸ï¼‰
// - æ¶æ„åŸŸåæ£€æµ‹ï¼ˆé…åˆå¨èƒæƒ…æŠ¥ï¼‰
```

##### 2.8 æµé‡è¡Œä¸ºç‰¹å¾
```go
type BehaviorFeatures struct {
    // è¿æ¥æ¨¡å¼
    ConnectionCount      int       // è¿æ¥æ•°
    UniqueIPCount        int       // å”¯ä¸€IPæ•°
    UniquePortCount      int       // å”¯ä¸€ç«¯å£æ•°
    FailedConnections    int       // å¤±è´¥è¿æ¥æ•°
    
    // æ—¶é—´æ¨¡å¼
    TimeOfDay            int       // æ´»åŠ¨æ—¶æ®µï¼ˆ0-23å°æ—¶ï¼‰
    DayOfWeek            int       // æ˜ŸæœŸå‡ 
    IsWorkingHours       bool      // æ˜¯å¦å·¥ä½œæ—¶é—´
    
    // é€šä¿¡æ¨¡å¼
    FanOutDegree         int       // å‡ºåº¦ï¼ˆå¯¹å¤–è¿æ¥æ•°ï¼‰
    FanInDegree          int       // å…¥åº¦ï¼ˆè¢«è¿æ¥æ•°ï¼‰
    
    // æ•°æ®ä¼ è¾“æ¨¡å¼
    UploadDownloadRatio  float64   // ä¸Šä¼ ä¸‹è½½æ¯”
    LongConnectionRatio  float64   // é•¿è¿æ¥å æ¯”
    ShortConnectionRatio float64   // çŸ­è¿æ¥å æ¯”
}

// åº”ç”¨åœºæ™¯ï¼š
// - æ¨ªå‘ç§»åŠ¨æ£€æµ‹ï¼ˆçªç„¶è®¿é—®å¤§é‡å†…ç½‘IPï¼‰
// - æ‰«ææ£€æµ‹ï¼ˆå¤§é‡çŸ­è¿æ¥ã€å¤±è´¥è¿æ¥ï¼‰
// - æ•°æ®æ³„éœ²æ£€æµ‹ï¼ˆä¸Šä¼ æµé‡å¼‚å¸¸å¢åŠ ï¼‰
// - APTæ£€æµ‹ï¼ˆéå·¥ä½œæ—¶é—´çš„å¼‚å¸¸æ´»åŠ¨ï¼‰
```

##### 2.9 ç»Ÿè®¡å­¦ç‰¹å¾
```go
type StatisticalFeatures struct {
    // ç†µå€¼ç‰¹å¾
    PacketLengthEntropy  float64  // åŒ…é•¿ç†µ
    IPEntropy            float64  // IPåœ°å€ç†µ
    PortEntropy          float64  // ç«¯å£ç†µ
    
    // åˆ†å¸ƒç‰¹å¾
    PacketLengthSkewness float64  // åŒ…é•¿ååº¦
    PacketLengthKurtosis float64  // åŒ…é•¿å³°åº¦
    
    // å˜å¼‚ç³»æ•°
    CVPacketLength       float64  // åŒ…é•¿å˜å¼‚ç³»æ•°
    CVIAT                float64  // IATå˜å¼‚ç³»æ•°
    
    // å‘¨æœŸæ€§ç‰¹å¾
    Periodicity          float64  // å‘¨æœŸæ€§å¼ºåº¦
    PeriodLength         float64  // å‘¨æœŸé•¿åº¦
}

// åº”ç”¨åœºæ™¯ï¼š
// - C2 Beaconæ£€æµ‹ï¼ˆå¼ºå‘¨æœŸæ€§ï¼‰
// - å¼‚å¸¸æµé‡æ£€æµ‹ï¼ˆç†µå€¼å¼‚å¸¸ï¼‰
// - åŠ å¯†æµé‡è¯†åˆ«ï¼ˆé«˜ç†µå€¼ï¼‰
```

##### 2.10 ä¼šè¯çº§ç‰¹å¾
```go
type SessionFeatures struct {
    // ä¼šè¯ç»Ÿè®¡
    SessionDuration      float64  // ä¼šè¯æ—¶é•¿
    SessionPackets       int64    // ä¼šè¯åŒ…æ•°
    SessionBytes         int64    // ä¼šè¯å­—èŠ‚æ•°
    
    // ä¼šè¯äº¤äº’ç‰¹å¾
    TurnsCount           int      // äº¤äº’è½®æ•°
    ClientServerRatio    float64  // å®¢æˆ·ç«¯æœåŠ¡ç«¯äº¤äº’æ¯”
    
    // ä¼šè¯è¡Œä¸º
    IdleTimeTotal        float64  // æ€»ç©ºé—²æ—¶é—´
    ActiveTimeTotal      float64  // æ€»æ´»è·ƒæ—¶é—´
    DataExchangeRatio    float64  // æ•°æ®äº¤æ¢æ¯”
}

// åº”ç”¨åœºæ™¯ï¼š
// - ä¼šè¯åŠ«æŒæ£€æµ‹
// - å¼‚å¸¸ä¼šè¯è¯†åˆ«
```

##### 2.11 å®Œæ•´ç‰¹å¾æå–å™¨
```go
type FeatureExtractor struct {
    flow *Flow
}

// å®Œæ•´ç‰¹å¾é›†
type AllFeatures struct {
    Basic        BasicFlowFeatures
    Temporal     TemporalFeatures
    TCP          TCPFeatures
    ProtocolDist ProtocolDistFeatures
    TLS          TLSFeatures
    HTTP         HTTPFeatures
    DNS          DNSFeatures
    Behavior     BehaviorFeatures
    Statistical  StatisticalFeatures
    Session      SessionFeatures
}

func NewFeatureExtractor(flow *Flow) *FeatureExtractor
func (e *FeatureExtractor) ExtractAll() *AllFeatures
func (e *FeatureExtractor) ExtractBasic() *BasicFlowFeatures
func (e *FeatureExtractor) ExtractTemporal() *TemporalFeatures
func (e *FeatureExtractor) ExtractTCP() *TCPFeatures
func (e *FeatureExtractor) ExtractProtocolDist() *ProtocolDistFeatures
func (e *FeatureExtractor) ExtractTLS() *TLSFeatures
func (e *FeatureExtractor) ExtractHTTP() *HTTPFeatures
func (e *FeatureExtractor) ExtractDNS() *DNSFeatures
func (e *FeatureExtractor) ExtractBehavior() *BehaviorFeatures
func (e *FeatureExtractor) ExtractStatistical() *StatisticalFeatures
func (e *FeatureExtractor) ExtractSession() *SessionFeatures

// å·¥å…·å‡½æ•°
func CalculateEntropy(data []byte) float64
func CalculateCV(values []float64) float64
func CalculateMean(values []float64) float64
func CalculateStdDev(values []float64) float64
func CalculateSkewness(values []float64) float64
func CalculateKurtosis(values []float64) float64
```

##### 2.12 æ£€æµ‹ç¤ºä¾‹
```go
package detection

// æ£€æµ‹C2 Beacon
func DetectC2Beacon(features *AllFeatures) bool {
    // ç‰¹å¾ç»„åˆï¼šè§„å¾‹æ—¶é—´é—´éš” + å›ºå®šåŒ…å¤§å° + å¼ºå‘¨æœŸæ€§ + é«˜ç†µå€¼
    isRegularTiming := features.Temporal.StdIAT < 1.0 && 
                       features.Temporal.MeanIAT > 5.0
    isFixedSize := features.Basic.StdPacketLength < 50
    isPeriodic := features.Statistical.Periodicity > 0.8
    isEncrypted := features.Statistical.PacketLengthEntropy > 7.0
    
    return isRegularTiming && isFixedSize && isPeriodic && isEncrypted
}

// æ£€æµ‹ç«¯å£æ‰«æ
func DetectPortScan(features *AllFeatures) bool {
    // ç‰¹å¾ç»„åˆï¼šå¤§é‡SYN + å¤šç«¯å£ + é«˜å¤±è´¥ç‡ + å•å‘æµé‡
    highSYNRate := features.TCP.SYNFlagCount > 100
    manyPorts := features.ProtocolDist.UniquePortCount > 20
    highFailureRate := float64(features.TCP.RSTFlagCount) / 
                       float64(features.Basic.PacketCount) > 0.5
    oneWayTraffic := features.Basic.BackwardPackets < 10
    
    return highSYNRate && manyPorts && highFailureRate && oneWayTraffic
}

// æ£€æµ‹DGAåŸŸå
func DetectDGA(dnsFeatures *DNSFeatures) bool {
    // ç‰¹å¾ç»„åˆï¼šé«˜ç†µå€¼ + ä½å…ƒéŸ³æ¯” + å¼‚å¸¸é•¿åº¦
    highEntropy := dnsFeatures.DomainEntropy > 4.0
    lowVowelRatio := dnsFeatures.VowelRatio < 0.3
    abnormalLength := dnsFeatures.DomainLength > 20
    
    return highEntropy && lowVowelRatio && abnormalLength
}

// æ£€æµ‹æ•°æ®æ³„éœ²
func DetectDataExfiltration(features *AllFeatures, baseline *TrafficBaseline) bool {
    // ç‰¹å¾ç»„åˆï¼šä¸Šä¼ æµé‡å¼‚å¸¸å¢åŠ  + éå·¥ä½œæ—¶é—´
    uploadRatio := features.Behavior.UploadDownloadRatio
    isAbnormalUpload := uploadRatio > 2.0  // ä¸Šä¼ è¿œå¤§äºä¸‹è½½
    isOffHours := !features.Behavior.IsWorkingHours
    isLargeVolume := features.Basic.ForwardBytes > baseline.AvgByteCount * 10
    
    return isAbnormalUpload && isOffHours && isLargeVolume
}
```

##### 2.13 ç‰¹å¾å­˜å‚¨ä¼˜åŒ–
```sql
-- ClickHouseè¡¨ç»“æ„è®¾è®¡
CREATE TABLE flow_features (
    timestamp DateTime,
    src_ip String,
    dst_ip String,
    src_port UInt16,
    dst_port UInt16,
    protocol String,
    
    -- åŸºç¡€ç‰¹å¾
    packet_count UInt64,
    byte_count UInt64,
    duration Float64,
    flow_rate Float64,
    
    -- æ—¶é—´ç‰¹å¾
    mean_iat Float64,
    std_iat Float64,
    
    -- åŒ…é•¿ç‰¹å¾
    mean_pkt_len Float64,
    std_pkt_len Float64,
    
    -- TCPç‰¹å¾
    syn_count UInt16,
    rst_count UInt16,
    
    -- ç»Ÿè®¡ç‰¹å¾
    entropy Float64,
    periodicity Float64,
    
    -- è¡Œä¸ºç‰¹å¾
    unique_ip_count UInt32,
    failed_connections UInt32,
    
    -- ç´¢å¼•ä¼˜åŒ–
    INDEX idx_src_ip src_ip TYPE bloom_filter GRANULARITY 1,
    INDEX idx_dst_ip dst_ip TYPE bloom_filter GRANULARITY 1
    
) ENGINE = MergeTree()
PARTITION BY toYYYYMM(timestamp)
ORDER BY (timestamp, src_ip, dst_ip)
TTL timestamp + INTERVAL 90 DAY;
```

**3. è¡Œä¸ºåŸºçº¿æ¨¡å—**
```go
package baseline

type BaselineBuilder struct {
    timeWindow    time.Duration
    storage       *ClickHouseClient
}

type TrafficBaseline struct {
    AssetIP       string
    AvgConnCount  float64
    AvgByteCount  float64
    TopProtocols  []ProtocolStat
    TopDstPorts   []PortStat
    TimeDistribution map[int]float64  // 24å°æ—¶åˆ†å¸ƒ
}

func (b *BaselineBuilder) BuildBaseline(assetIP string) (*TrafficBaseline, error)
func (b *BaselineBuilder) UpdateBaseline(assetIP string)
func (b *BaselineBuilder) CompareWithBaseline(current, baseline *TrafficBaseline) float64
```

**4. å¼‚å¸¸æ£€æµ‹æ¨¡å—**
```go
package anomaly

type AnomalyDetector interface {
    Detect(metrics *Metrics) []Anomaly
    Train(historicalData []Metrics) error
}

// ç»Ÿè®¡å­¦æ–¹æ³•
type StatisticalDetector struct {
    mean   float64
    stddev float64
    threshold float64
}

func (d *StatisticalDetector) Detect(value float64) bool
func (d *StatisticalDetector) UpdateModel(newData []float64)

// æ—¶åºå¼‚å¸¸æ£€æµ‹
type TimeSeriesDetector struct {
    model *TSModel
}

func (d *TimeSeriesDetector) DetectAnomaly(timeseries []DataPoint) []Anomaly
```

#### å·¥ç¨‹åŒ–è¦ç‚¹
- å®æ—¶ç‰¹å¾è®¡ç®—ç®¡é“ï¼ˆæµå¤„ç†ï¼‰
- ç‰¹å¾å­˜å‚¨ä¼˜åŒ–ï¼ˆClickHouseåˆ—å¼å­˜å‚¨ï¼‰
- å¤§è§„æ¨¡IPèµ„äº§çš„åŸºçº¿ç®¡ç†
- å¼‚å¸¸æ£€æµ‹çš„è¯¯æŠ¥æ§åˆ¶

#### å¼€æºå·¥å…·æ¨è
- **NFStream**ï¼šPythonåº“ï¼Œæ”¯æŒå®æ—¶æµé‡ç‰¹å¾æå–ï¼Œå¯æå–80+ç‰¹å¾

---

### 1.4 æ•°æ®å­˜å‚¨ä¸ç®¡ç†

> ğŸ“„ **è¯¦ç»†å†…å®¹è¯·å‚é˜…ï¼š[æ•°æ®å­˜å‚¨å’Œç®¡ç†.md](./æ•°æ®å­˜å‚¨å’Œç®¡ç†.md)**

æœ¬ç« èŠ‚æ¶µç›–ï¼š
- **å­˜å‚¨æ¶æ„è®¾è®¡**ï¼š5å±‚æ•°æ®åˆ†å±‚æ¨¡å‹ï¼ˆPCAP â†’ Flow â†’ åè®®å…ƒæ•°æ® â†’ æµé‡ç‰¹å¾ â†’ å‘Šè­¦ï¼‰
- **æ ¸å¿ƒè¡¨ç»“æ„**ï¼š6å¼ æ ¸å¿ƒè¡¨çš„ClickHouse DDLå®šä¹‰
- **æ•°æ®å†™å…¥æ¨¡å—**ï¼šæ‰¹é‡å†™å…¥ç®¡é“ã€Flowç¼“å­˜ç®¡ç†
- **æ•°æ®æŸ¥è¯¢æ¨¡å—**ï¼šæŸ¥è¯¢æœåŠ¡ã€ç»Ÿè®¡èšåˆã€å¨èƒç‹©çŒSQLç¤ºä¾‹
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šå†·çƒ­æ•°æ®åˆ†ç¦»ã€è‡ªåŠ¨å½’æ¡£ç­–ç•¥
- **æ€§èƒ½ä¼˜åŒ–**ï¼šç‰©åŒ–è§†å›¾ã€åˆ†åŒºä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–
- **å®¹é‡è§„åˆ’**ï¼š1Gbpsç¯å¢ƒä¸‹çš„å­˜å‚¨å®¹é‡ä¼°ç®—å’Œç¡¬ä»¶é…ç½®å»ºè®®

---

## äºŒã€ç½‘ç»œå®‰å…¨æ£€æµ‹ä½“ç³»

### 2.1 è§„åˆ™å¼•æ“ä¸æ£€æµ‹é€»è¾‘

#### æ ¸å¿ƒæŠ€æœ¯
- **è§„åˆ™è¯­è¨€**ï¼šSuricataè§„åˆ™æ‰©å±•ã€è‡ªç ”DSL
- **æ¨¡å¼åŒ¹é…**ï¼šACè‡ªåŠ¨æœºã€Boyer-Mooreç®—æ³•
- **æ­£åˆ™ä¼˜åŒ–**ï¼šé¢„ç¼–è¯‘ã€DFAä¼˜åŒ–
- **æ€§èƒ½ä¼˜åŒ–**ï¼šè§„åˆ™åˆ†ç»„ã€é¢„è¿‡æ»¤ã€å¹¶è¡Œå¤„ç†

#### æ¶æ„è®¾è®¡
```
[æµé‡æ•°æ®] â†’ [é¢„è¿‡æ»¤å™¨] â†’ [è§„åˆ™åŒ¹é…å¼•æ“] â†’ [åå¤„ç†] â†’ [å‘Šè­¦ç”Ÿæˆ]
                              â†“
                        [è§„åˆ™ç®¡ç†å¹³å°]
```

#### æ ¸å¿ƒæ¨¡å—è®¾è®¡

**1. è§„åˆ™ç®¡ç†æ¨¡å—**
```go
package rules

type RuleManager struct {
    rules       []*Rule
    ruleGroups  map[string]*RuleGroup
    ruleIndex   *RuleIndex
}

type Rule struct {
    ID          string
    Name        string
    Severity    string
    Protocol    string
    SrcIP       string
    DstIP       string
    SrcPort     string
    DstPort     string
    Content     []ContentMatch
    PCREPattern string
    Metadata    map[string]string
    Enabled     bool
}

type ContentMatch struct {
    Pattern     string
    Offset      int
    Depth       int
    Distance    int
    Within      int
}

func (m *RuleManager) LoadRules(path string) error
func (m *RuleManager) AddRule(rule *Rule) error
func (m *RuleManager) UpdateRule(ruleID string, rule *Rule) error
func (m *RuleManager) DeleteRule(ruleID string) error
func (m *RuleManager) CompileRules() error
func (m *RuleManager) HotReload() error
```

**2. æ£€æµ‹å¼•æ“æ¨¡å—**
```go
package detection

type DetectionEngine struct {
    ruleManager     *RuleManager
    matcher         *PatternMatcher
    prefilter       *Prefilter
    alertQueue      chan *Alert
}

type PatternMatcher struct {
    acMatcher      *ACAutomaton
    pcreMatcher    *PCREMatcher
}

func NewDetectionEngine() *DetectionEngine
func (e *DetectionEngine) Detect(packet *Packet) []*Alert
func (e *DetectionEngine) DetectFlow(flow *Flow) []*Alert
func (e *DetectionEngine) MatchRules(data []byte, rules []*Rule) []*Match
```

**3. é¢„è¿‡æ»¤å™¨æ¨¡å—**
```go
package prefilter

type Prefilter struct {
    ipFilter      *IPFilter
    portFilter    *PortFilter
    protocolFilter *ProtocolFilter
}

func (p *Prefilter) ShouldProcess(packet *Packet, rule *Rule) bool
func (p *Prefilter) BuildFilterIndex(rules []*Rule)
```

**4. æ¨¡å¼åŒ¹é…æ¨¡å—**
```go
package matcher

type ACAutomaton struct {
    root  *ACNode
    patterns []string
}

type ACNode struct {
    children map[byte]*ACNode
    fail     *ACNode
    output   []int
}

func NewACAutomaton() *ACAutomaton
func (ac *ACAutomaton) AddPattern(pattern string, id int)
func (ac *ACAutomaton) Build()
func (ac *ACAutomaton) Search(text []byte) []Match

type PCREMatcher struct {
    compiled []*regexp.Regexp
}

func (p *PCREMatcher) Compile(patterns []string) error
func (p *PCREMatcher) Match(text []byte) []Match
```

**5. å‘Šè­¦ç”Ÿæˆæ¨¡å—**
```go
package alert

type Alert struct {
    ID            string
    Timestamp     time.Time
    RuleID        string
    RuleName      string
    Severity      string
    SrcIP         string
    DstIP         string
    SrcPort       uint16
    DstPort       uint16
    Protocol      string
    Payload       []byte
    Metadata      map[string]interface{}
}

type AlertManager struct {
    queue         chan *Alert
    aggregator    *AlertAggregator
    kafkaProducer *KafkaProducer
}

func (m *AlertManager) GenerateAlert(match *Match, packet *Packet) *Alert
func (m *AlertManager) PublishAlert(alert *Alert) error
```

#### å·¥ç¨‹åŒ–è¦ç‚¹
- è§„åˆ™çƒ­åŠ è½½æœºåˆ¶ï¼ˆæ— éœ€é‡å¯æœåŠ¡ï¼‰
- è§„åˆ™æ€§èƒ½åˆ†æå·¥å…·
- è§„åˆ™æµ‹è¯•æ¡†æ¶ï¼ˆå›å½’æµ‹è¯•ï¼‰
- åˆ†å¸ƒå¼è§„åˆ™åŒæ­¥

#### ä¸Suricataé›†æˆ
```go
package suricata

type SuricataWrapper struct {
    configPath    string
    rulesPath     string
    logPath       string
    process       *exec.Cmd
}

func (s *SuricataWrapper) Start() error
func (s *SuricataWrapper) Stop() error
func (s *SuricataWrapper) ReloadRules() error
func (s *SuricataWrapper) ParseEVELog() chan *Alert
func (s *SuricataWrapper) GetStats() *Stats
```

---

### 2.2 å¨èƒæ£€æµ‹ä¸å“åº”

#### æ ¸å¿ƒæŠ€æœ¯
- **æ£€æµ‹ç±»å‹**ï¼šå…¥ä¾µæ£€æµ‹ã€æ¶æ„è½¯ä»¶é€šä¿¡ã€æ•°æ®æ³„éœ²ã€æ¨ªå‘ç§»åŠ¨
- **å¨èƒæƒ…æŠ¥**ï¼šIOCåŒ¹é…ï¼ˆIP/Domain/Hashï¼‰ã€STIX/TAXIIåè®®
- **äº‹ä»¶å…³è”**ï¼šå¤šæºæ•°æ®å…³è”åˆ†æ
- **è‡ªåŠ¨åŒ–å“åº”**ï¼šå‘Šè­¦é™å™ªã€è‡ªåŠ¨åŒ–å¤„ç½®

#### æ¶æ„è®¾è®¡
```
[å¤šæ•°æ®æº] â†’ [äº‹ä»¶é‡‡é›†] â†’ [å…³è”åˆ†æå¼•æ“] â†’ [å¨èƒæƒ…æŠ¥åŒ¹é…] â†’ [å“åº”å¤„ç½®]
    â†“
[å¨èƒæƒ…æŠ¥å¹³å°] â† [æƒ…æŠ¥è®¢é˜…/æ›´æ–°]
```

#### æ ¸å¿ƒæ¨¡å—è®¾è®¡

**1. å¨èƒæƒ…æŠ¥ç®¡ç†**
```go
package threat_intel

type ThreatIntelManager struct {
    storage       *ThreatIntelStorage
    updater       *IntelUpdater
    matcher       *IOCMatcher
}

type IOC struct {
    Type         string  // ip, domain, hash, url
    Value        string
    ThreatType   string
    Confidence   int
    Source       string
    FirstSeen    time.Time
    LastSeen     time.Time
    Tags         []string
}

func (m *ThreatIntelManager) ImportIOCs(iocs []IOC) error
func (m *ThreatIntelManager) QueryIOC(value string) (*IOC, bool)
func (m *ThreatIntelManager) UpdateFromFeeds(feeds []Feed) error
func (m *ThreatIntelManager) MatchAlert(alert *Alert) []IOC
```

**2. æ£€æµ‹è§„åˆ™å¼•æ“**
```go
package detection

// å…¥ä¾µæ£€æµ‹
type IntrusionDetector struct {
    signatureDB   *SignatureDatabase
}

func (d *IntrusionDetector) DetectExploit(packet *Packet) []Detection
func (d *IntrusionDetector) DetectScanActivity(flows []*Flow) []Detection

// C2é€šä¿¡æ£€æµ‹
type C2Detector struct {
    beaconDetector    *BeaconDetector
    domainReputation  *DomainReputation
}

func (d *C2Detector) DetectBeaconing(flows []*Flow) []Detection
func (d *C2Detector) DetectDGA(dnsQueries []DNSQuery) []Detection

// æ•°æ®æ³„éœ²æ£€æµ‹
type DataExfiltrationDetector struct {
    baselineManager *BaselineManager
}

func (d *DataExfiltrationDetector) DetectLargeUpload(flow *Flow) bool
func (d *DataExfiltrationDetector) DetectUnusualProtocol(flow *Flow) bool

// æ¨ªå‘ç§»åŠ¨æ£€æµ‹
type LateralMovementDetector struct {
    assetGraph *AssetGraph
}

func (d *LateralMovementDetector) DetectSMBBruteforce(flows []*Flow) []Detection
func (d *LateralMovementDetector) DetectRDPSpray(flows []*Flow) []Detection
```

**3. äº‹ä»¶å…³è”å¼•æ“**
```go
package correlation

type CorrelationEngine struct {
    rules          []*CorrelationRule
    eventBuffer    *TimeWindowBuffer
}

type CorrelationRule struct {
    ID             string
    Name           string
    EventTypes     []string
    TimeWindow     time.Duration
    Conditions     []Condition
    Threshold      int
}

type Condition struct {
    Field          string
    Operator       string
    Value          interface{}
}

func (e *CorrelationEngine) AddEvent(event *Event)
func (e *CorrelationEngine) Correlate() []*CorrelatedAlert
func (e *CorrelationEngine) MatchRule(rule *CorrelationRule, events []*Event) bool
```

**4. å“åº”å¤„ç½®æ¨¡å—**
```go
package response

type ResponseManager struct {
    playbooks     map[string]*Playbook
    executor      *ActionExecutor
}

type Playbook struct {
    ID            string
    Name          string
    TriggerType   string
    Actions       []Action
}

type Action interface {
    Execute(context *Context) error
    Rollback() error
}

// å°ç¦IP
type BlockIPAction struct {
    IP       string
    Duration time.Duration
    Firewall FirewallClient
}

func (a *BlockIPAction) Execute(ctx *Context) error

// å‘é€é€šçŸ¥
type NotifyAction struct {
    Channel  string  // email, slack, webhook
    Message  string
}

func (a *NotifyAction) Execute(ctx *Context) error

// éš”ç¦»ä¸»æœº
type IsolateHostAction struct {
    HostIP   string
}

func (a *IsolateHostAction) Execute(ctx *Context) error
```

#### å·¥ç¨‹åŒ–è¦ç‚¹
- å¨èƒæƒ…æŠ¥è‡ªåŠ¨æ›´æ–°æœºåˆ¶
- IOCåŒ¹é…æ€§èƒ½ä¼˜åŒ–ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰
- è¯¯æŠ¥å¤„ç†ä¸ç™½åå•ç®¡ç†
- å“åº”åŠ¨ä½œçš„å®¡è®¡æ—¥å¿—

---

### 2.3 æµé‡å®‰å…¨åˆ†æå¹³å°ï¼ˆNDRï¼‰

#### æ ¸å¿ƒåŠŸèƒ½
- **å®æ—¶æ£€æµ‹**ï¼šç§’çº§å¨èƒå‘ç°
- **å†å²å›æº¯**ï¼šPCAPå­˜å‚¨ä¸æ£€ç´¢
- **å¨èƒç‹©çŒ**ï¼šä¸»åŠ¨å¨èƒæœç´¢
- **å–è¯åˆ†æ**ï¼šæ·±åº¦æµé‡åˆ†æ

#### ç³»ç»Ÿæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å‰ç«¯å±•ç¤ºå±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›‘æ§å¤§å± â”‚ å‘Šè­¦ä¸­å¿ƒ â”‚ è§„åˆ™ç®¡ç† â”‚ å¨èƒç‹©çŒ â”‚ æŠ¥è¡¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ RESTful API / WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯æœåŠ¡å±‚                      â”‚
â”‚  APIç½‘å…³ â”‚ è®¤è¯æœåŠ¡ â”‚ æŸ¥è¯¢æœåŠ¡ â”‚ åˆ†ææœåŠ¡        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ•°æ®å¤„ç†å±‚                        â”‚
â”‚  å®æ—¶åˆ†æ â”‚ äº‹ä»¶å…³è” â”‚ å¨èƒåŒ¹é… â”‚ ç»Ÿè®¡èšåˆ       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æµé‡ç‰¹å¾æå–                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kafkaæ¶ˆæ¯é˜Ÿåˆ— â”‚                  â”‚  å­˜å‚¨å±‚        â”‚
â”‚  (æ•°æ®æ€»çº¿)    â”‚                  â”‚ ClickHouse    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ Elasticsearch â”‚
       â”‚                            â”‚ MinIO         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  é‡‡é›†Agenté›†ç¾¤ â”‚
â”‚  (åˆ†å¸ƒå¼éƒ¨ç½²) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒæ¨¡å—è®¾è®¡

**1. æŸ¥è¯¢æœåŠ¡æ¨¡å—**
```go
package query

type QueryService struct {
    clickhouse *ClickHouseClient
    elasticsearch *ESClient
    cache      *QueryCache
}

// å‘Šè­¦æŸ¥è¯¢
func (s *QueryService) QueryAlerts(req *AlertQueryRequest) (*AlertQueryResponse, error)
func (s *QueryService) GetAlertDetail(alertID string) (*Alert, error)
func (s *QueryService) GetAlertStatistics(timeRange TimeRange) (*Statistics, error)

// æµé‡æŸ¥è¯¢
func (s *QueryService) QueryFlows(req *FlowQueryRequest) (*FlowQueryResponse, error)
func (s *QueryService) QueryHTTPLogs(req *HTTPQueryRequest) (*HTTPQueryResponse, error)
func (s *QueryService) QueryDNSLogs(req *DNSQueryRequest) (*DNSQueryResponse, error)

// PCAPæ£€ç´¢
func (s *QueryService) SearchPCAP(filters *PCAPFilters) ([]string, error)
func (s *QueryService) DownloadPCAP(pcapID string) (io.Reader, error)
```

**2. å¨èƒç‹©çŒæ¨¡å—**
```go
package hunting

type ThreatHuntingService struct {
    queryEngine   *QueryEngine
    analyzer      *ThreatAnalyzer
}

type HuntingQuery struct {
    Name          string
    Description   string
    QueryType     string  // sql, dsl, script
    QueryContent  string
    TimeRange     TimeRange
}

type HuntingResult struct {
    QueryID       string
    MatchCount    int
    Matches       []Match
    Risk          string
}

func (s *ThreatHuntingService) ExecuteHunt(query *HuntingQuery) (*HuntingResult, error)
func (s *ThreatHuntingService) SaveHuntTemplate(template *HuntTemplate) error
func (s *ThreatHuntingService) GetHuntHistory() ([]*HuntingResult, error)
```

**3. å®æ—¶åˆ†ææœåŠ¡**
```go
package realtime

type RealtimeAnalyzer struct {
    kafkaConsumer  *KafkaConsumer
    detectionEngine *DetectionEngine
    correlationEngine *CorrelationEngine
    alertManager   *AlertManager
}

func (a *RealtimeAnalyzer) Start() error
func (a *RealtimeAnalyzer) ProcessMessage(msg *Message) error
func (a *RealtimeAnalyzer) HandleAlert(alert *Alert) error
```

**4. ç»Ÿè®¡èšåˆæœåŠ¡**
```go
package aggregation

type AggregationService struct {
    clickhouse *ClickHouseClient
}

// å®æ—¶ç»Ÿè®¡
func (s *AggregationService) GetTopTalkers(limit int) ([]*TopTalker, error)
func (s *AggregationService) GetProtocolDistribution() (map[string]int64, error)
func (s *AggregationService) GetTrafficTrend(interval string) (*TrendData, error)

// å‘Šè­¦ç»Ÿè®¡
func (s *AggregationService) GetAlertSeverityDistribution() (map[string]int, error)
func (s *AggregationService) GetTopAttackTypes() ([]*AttackStat, error)
func (s *AggregationService) GetMTTD() (time.Duration, error)  // Mean Time To Detect
```

#### PCAPç®¡ç†
```go
package pcap

type PCAPManager struct {
    storage       *MinIOClient
    indexer       *PCAPIndexer
    rotatePolicy  *RotatePolicy
}

type PCAPMetadata struct {
    ID            string
    StartTime     time.Time
    EndTime       time.Time
    PacketCount   int64
    ByteCount     int64
    StoragePath   string
    Indexed       bool
}

func (m *PCAPManager) SavePCAP(pcap []byte, metadata *PCAPMetadata) error
func (m *PCAPManager) GetPCAP(id string) ([]byte, error)
func (m *PCAPManager) SearchPCAP(filters *Filters) ([]*PCAPMetadata, error)
func (m *PCAPManager) RotatePCAP() error  // è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®
```

#### å·¥ç¨‹åŒ–è¦ç‚¹
- å®æ—¶æµå¤„ç†æ€§èƒ½ä¼˜åŒ–
- å¤§è§„æ¨¡æ•°æ®å­˜å‚¨ä¸æ£€ç´¢
- æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ï¼ˆç´¢å¼•ã€ç¼“å­˜ï¼‰
- WebSocketå®æ—¶æ¨é€

---

## ä¸‰ã€äº§å“åŒ–å¼€å‘å®æˆ˜

### 3.1 åç«¯APIè®¾è®¡

#### APIæ¶æ„
```
[å®¢æˆ·ç«¯] â†’ [APIç½‘å…³] â†’ [è®¤è¯ä¸­é—´ä»¶] â†’ [ä¸šåŠ¡æœåŠ¡] â†’ [æ•°æ®å±‚]
                â†“
          [é™æµ/ç†”æ–­/æ—¥å¿—]
```

#### æ ¸å¿ƒAPIæ¨¡å—

**1. APIç½‘å…³**
```go
package gateway

type APIGateway struct {
    router        *gin.Engine
    authManager   *AuthManager
    rateLimiter   *RateLimiter
    logger        *Logger
}

func (g *APIGateway) RegisterRoutes()
func (g *APIGateway) AuthMiddleware() gin.HandlerFunc
func (g *APIGateway) RateLimitMiddleware() gin.HandlerFunc
func (g *APIGateway) LoggingMiddleware() gin.HandlerFunc
func (g *APIGateway) CORSMiddleware() gin.HandlerFunc
```

**2. è®¾å¤‡ç®¡ç†API**
```go
package api

type AgentAPI struct {
    agentManager *AgentManager
}

// Agentæ³¨å†Œä¸ç®¡ç†
func (a *AgentAPI) RegisterAgent(c *gin.Context)
func (a *AgentAPI) ListAgents(c *gin.Context)
func (a *AgentAPI) GetAgentDetail(c *gin.Context)
func (a *AgentAPI) UpdateAgentConfig(c *gin.Context)
func (a *AgentAPI) DeleteAgent(c *gin.Context)

// Agentç›‘æ§
func (a *AgentAPI) GetAgentStatus(c *gin.Context)
func (a *AgentAPI) GetAgentMetrics(c *gin.Context)
func (a *AgentAPI) AgentHeartbeat(c *gin.Context)
```

**3. è§„åˆ™ç®¡ç†API**
```go
package api

type RuleAPI struct {
    ruleManager *RuleManager
}

// è§„åˆ™CRUD
func (r *RuleAPI) CreateRule(c *gin.Context)
func (r *RuleAPI) GetRule(c *gin.Context)
func (r *RuleAPI) ListRules(c *gin.Context)
func (r *RuleAPI) UpdateRule(c *gin.Context)
func (r *RuleAPI) DeleteRule(c *gin.Context)

// è§„åˆ™æ“ä½œ
func (r *RuleAPI) EnableRule(c *gin.Context)
func (r *RuleAPI) DisableRule(c *gin.Context)
func (r *RuleAPI) TestRule(c *gin.Context)
func (r *RuleAPI) ImportRules(c *gin.Context)
func (r *RuleAPI) ExportRules(c *gin.Context)

// è§„åˆ™æ€§èƒ½
func (r *RuleAPI) GetRulePerformance(c *gin.Context)
```

**4. å‘Šè­¦ç®¡ç†API**
```go
package api

type AlertAPI struct {
    alertManager *AlertManager
}

// å‘Šè­¦æŸ¥è¯¢
func (a *AlertAPI) ListAlerts(c *gin.Context)
func (a *AlertAPI) GetAlertDetail(c *gin.Context)
func (a *AlertAPI) SearchAlerts(c *gin.Context)

// å‘Šè­¦å¤„ç†
func (a *AlertAPI) AcknowledgeAlert(c *gin.Context)
func (a *AlertAPI) CloseAlert(c *gin.Context)
func (a *AlertAPI) AddAlertComment(c *gin.Context)

// å‘Šè­¦ç»Ÿè®¡
func (a *AlertAPI) GetAlertStatistics(c *gin.Context)
func (a *AlertAPI) GetAlertTrend(c *gin.Context)
```

**5. æ•°æ®æŸ¥è¯¢API**
```go
package api

type QueryAPI struct {
    queryService *QueryService
}

// æµé‡æŸ¥è¯¢
func (q *QueryAPI) QueryFlows(c *gin.Context)
func (q *QueryAPI) QueryHTTPLogs(c *gin.Context)
func (q *QueryAPI) QueryDNSLogs(c *gin.Context)
func (q *QueryAPI) QueryTLSLogs(c *gin.Context)

// ç»Ÿè®¡æŸ¥è¯¢
func (q *QueryAPI) GetTrafficStatistics(c *gin.Context)
func (q *QueryAPI) GetProtocolDistribution(c *gin.Context)
func (q *QueryAPI) GetTopTalkers(c *gin.Context)

// PCAPç®¡ç†
func (q *QueryAPI) SearchPCAP(c *gin.Context)
func (q *QueryAPI) DownloadPCAP(c *gin.Context)
```

**6. å¨èƒç‹©çŒAPI**
```go
package api

type HuntingAPI struct {
    huntingService *HuntingService
}

func (h *HuntingAPI) ExecuteHunt(c *gin.Context)
func (h *HuntingAPI) ListHuntTemplates(c *gin.Context)
func (h *HuntingAPI) SaveHuntTemplate(c *gin.Context)
func (h *HuntingAPI) GetHuntHistory(c *gin.Context)
```

**7. ç”¨æˆ·ç®¡ç†API**
```go
package api

type UserAPI struct {
    userManager *UserManager
}

// è®¤è¯
func (u *UserAPI) Login(c *gin.Context)
func (u *UserAPI) Logout(c *gin.Context)
func (u *UserAPI) RefreshToken(c *gin.Context)

// ç”¨æˆ·ç®¡ç†
func (u *UserAPI) CreateUser(c *gin.Context)
func (u *UserAPI) GetUser(c *gin.Context)
func (u *UserAPI) UpdateUser(c *gin.Context)
func (u *UserAPI) DeleteUser(c *gin.Context)

// æƒé™ç®¡ç† (RBAC)
func (u *UserAPI) AssignRole(c *gin.Context)
func (u *UserAPI) ListRoles(c *gin.Context)
func (u *UserAPI) CreateRole(c *gin.Context)
```

#### è®¤è¯ä¸æˆæƒ
```go
package auth

type AuthManager struct {
    jwtSecret     string
    tokenExpiry   time.Duration
    redisClient   *redis.Client
}

type Claims struct {
    UserID    string
    Username  string
    Roles     []string
    jwt.StandardClaims
}

func (m *AuthManager) GenerateToken(user *User) (string, error)
func (m *AuthManager) ValidateToken(token string) (*Claims, error)
func (m *AuthManager) CheckPermission(userID string, resource string, action string) bool

// RBAC
type RBACManager struct {
    policies map[string]*Policy
}

type Policy struct {
    Role      string
    Resource  string
    Actions   []string
}

func (m *RBACManager) Enforce(role, resource, action string) bool
```

---

### 3.2 å‰ç«¯ç®¡ç†å¹³å°

#### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**ï¼šReact 18 + TypeScript
- **çŠ¶æ€ç®¡ç†**ï¼šRedux Toolkit / Zustand
- **UIç»„ä»¶**ï¼šAnt Design / Material-UI
- **å›¾è¡¨åº“**ï¼šECharts / Recharts
- **ç½‘ç»œæ‹“æ‰‘**ï¼šG6 / Cytoscape.js
- **è¡¨æ ¼**ï¼šag-Grid (å¤§æ•°æ®é‡)

#### æ ¸å¿ƒé¡µé¢æ¨¡å—

**1. å®æ—¶ç›‘æ§å¤§å±**
```typescript
// ç»„ä»¶ç»“æ„
interface DashboardProps {
  refreshInterval: number;
}

// æ ¸å¿ƒæ•°æ®
interface DashboardData {
  realTimeMetrics: {
    totalTraffic: number;
    alertCount: number;
    topAttacks: AttackType[];
  };
  trafficTrend: TimeSeriesData[];
  alertDistribution: ChartData;
  topTalkers: TalkerInfo[];
  protocolDistribution: PieChartData;
}

// ä¸»è¦åŠŸèƒ½
- å®æ—¶æµé‡ç»Ÿè®¡
- å‘Šè­¦æ•°é‡è¶‹åŠ¿
- æ”»å‡»ç±»å‹åˆ†å¸ƒ
- ç½‘ç»œæ‹“æ‰‘å¯è§†åŒ–
- Top Nèµ„äº§/æ”»å‡»æº
```

**2. å‘Šè­¦ä¸­å¿ƒ**
```typescript
interface AlertCenterProps {
  filters: AlertFilters;
}

interface AlertFilters {
  severity: string[];
  timeRange: TimeRange;
  sourceIP: string;
  destIP: string;
  attackType: string;
  status: string;
}

// ä¸»è¦åŠŸèƒ½
- å‘Šè­¦åˆ—è¡¨å±•ç¤ºï¼ˆæ”¯æŒåˆ†é¡µã€æ’åºã€è¿‡æ»¤ï¼‰
- å‘Šè­¦è¯¦æƒ…æŸ¥çœ‹ï¼ˆåŸå§‹æ•°æ®ã€PCAPä¸‹è½½ï¼‰
- å‘Šè­¦å¤„ç†ï¼ˆç¡®è®¤ã€å…³é—­ã€æ‰¹é‡æ“ä½œï¼‰
- å‘Šè­¦è¯„è®ºä¸åä½œ
- å‘Šè­¦å¯¼å‡º
```

**3. è§„åˆ™ç®¡ç†**
```typescript
interface RuleManagementProps {
  ruleSource: string;  // custom, suricata, etc
}

interface Rule {
  id: string;
  name: string;
  severity: string;
  protocol: string;
  content: string;
  enabled: boolean;
  performance: PerformanceMetrics;
}

// ä¸»è¦åŠŸèƒ½
- è§„åˆ™åˆ—è¡¨ï¼ˆæœç´¢ã€è¿‡æ»¤ã€åˆ†ç»„ï¼‰
- è§„åˆ™ç¼–è¾‘å™¨ï¼ˆè¯­æ³•é«˜äº®ã€è‡ªåŠ¨è¡¥å…¨ï¼‰
- è§„åˆ™æµ‹è¯•ï¼ˆåœ¨çº¿æµ‹è¯•ã€PCAPå›æ”¾ï¼‰
- è§„åˆ™å¯¼å…¥å¯¼å‡º
- è§„åˆ™æ€§èƒ½åˆ†æ
- è§„åˆ™ç‰ˆæœ¬ç®¡ç†
```

**4. å¨èƒç‹©çŒ**
```typescript
interface ThreatHuntingProps {
  savedQueries: HuntQuery[];
}

interface HuntQuery {
  name: string;
  queryType: 'sql' | 'dsl';
  queryContent: string;
  timeRange: TimeRange;
}

// ä¸»è¦åŠŸèƒ½
- è‡ªå®šä¹‰æŸ¥è¯¢æ„å»ºå™¨ï¼ˆå¯è§†åŒ–+SQLï¼‰
- æŸ¥è¯¢ç»“æœå±•ç¤º
- ç»“æœå¯è§†åŒ–ï¼ˆå›¾è¡¨ã€æ—¶é—´çº¿ï¼‰
- æŸ¥è¯¢æ¨¡æ¿åº“
- æŸ¥è¯¢å†å²è®°å½•
```

**5. æµé‡åˆ†æ**
```typescript
interface TrafficAnalysisProps {
  analysisType: string;
}

// ä¸»è¦åŠŸèƒ½
- åè®®åˆ†æï¼ˆHTTP/DNS/TLSè¯¦ç»†ä¿¡æ¯ï¼‰
- ä¼šè¯åˆ†æï¼ˆå®Œæ•´ä¼šè¯é‡ç»„ï¼‰
- æ–‡ä»¶æå–ï¼ˆä»æµé‡ä¸­æå–æ–‡ä»¶ï¼‰
- æµé‡ç»Ÿè®¡ï¼ˆå¤šç»´åº¦ç»Ÿè®¡åˆ†æï¼‰
- PCAPç®¡ç†ï¼ˆä¸Šä¼ ã€ä¸‹è½½ã€æ£€ç´¢ï¼‰
```

**6. èµ„äº§ç®¡ç†**
```typescript
interface Asset {
  ip: string;
  hostname: string;
  mac: string;
  os: string;
  openPorts: number[];
  services: Service[];
  riskLevel: string;
  lastSeen: Date;
}

// ä¸»è¦åŠŸèƒ½
- èµ„äº§è‡ªåŠ¨å‘ç°
- èµ„äº§è¯¦æƒ…æŸ¥çœ‹
- èµ„äº§åˆ†ç»„ç®¡ç†
- èµ„äº§é£é™©è¯„ä¼°
- èµ„äº§æµé‡åˆ†æ
```

**7. æŠ¥è¡¨ç³»ç»Ÿ**
```typescript
interface Report {
  type: string;  // daily, weekly, monthly, custom
  format: string;  // pdf, excel, html
  template: ReportTemplate;
}

// ä¸»è¦åŠŸèƒ½
- é¢„å®šä¹‰æŠ¥è¡¨æ¨¡æ¿
- è‡ªå®šä¹‰æŠ¥è¡¨è®¾è®¡å™¨
- å®šæ—¶æŠ¥è¡¨ç”Ÿæˆ
- æŠ¥è¡¨å¯¼å‡ºï¼ˆPDF/Excelï¼‰
- æŠ¥è¡¨è®¢é˜…ï¼ˆé‚®ä»¶æ¨é€ï¼‰
```

#### WebSocketå®æ—¶æ¨é€
```typescript
// WebSocketå®¢æˆ·ç«¯
class RealtimeService {
  private ws: WebSocket;
  
  connect(url: string): void;
  subscribe(topic: string, callback: Function): void;
  unsubscribe(topic: string): void;
  
  // è®¢é˜…ä¸»é¢˜
  subscribeToAlerts(): void;
  subscribeToMetrics(): void;
  subscribeToAgentStatus(): void;
}
```

---

### 3.3 æ•°æ®å¯è§†åŒ–

#### æ ¸å¿ƒå¯è§†åŒ–ç»„ä»¶

**1. ç½‘ç»œæ‹“æ‰‘å›¾**
```typescript
interface NetworkTopology {
  nodes: NetworkNode[];
  edges: NetworkEdge[];
}

interface NetworkNode {
  id: string;
  label: string;
  type: 'asset' | 'attacker' | 'external';
  riskLevel: number;
  metrics: NodeMetrics;
}

interface NetworkEdge {
  source: string;
  target: string;
  traffic: number;
  alertCount: number;
}

// åŠŸèƒ½ï¼š
- å®æ—¶æµé‡æ‹“æ‰‘
- æ”»å‡»è·¯å¾„å¯è§†åŒ–
- èµ„äº§å…³ç³»å›¾
- äº¤äº’å¼æ“ä½œï¼ˆç¼©æ”¾ã€æ‹–æ‹½ã€è¿‡æ»¤ï¼‰
```

**2. æ”»å‡»é“¾è·¯å›¾**
```typescript
interface AttackChain {
  stages: AttackStage[];
  timeline: TimelineEvent[];
}

interface AttackStage {
  stage: string;  // reconnaissance, exploitation, lateral_movement, etc
  events: Event[];
  timestamp: Date;
}

// åŠŸèƒ½ï¼š
- MITRE ATT&CKæ˜ å°„
- æ”»å‡»æ—¶é—´çº¿
- å¤šé˜¶æ®µå…³è”å±•ç¤º
```

**3. æµé‡è¶‹åŠ¿å›¾**
```typescript
interface TrafficTrend {
  timeseries: DataPoint[];
  aggregation: string;  // 5m, 1h, 1d
}

// åŠŸèƒ½ï¼š
- å¤šæŒ‡æ ‡è¶‹åŠ¿ï¼ˆæµé‡ã€è¿æ¥æ•°ã€å‘Šè­¦ï¼‰
- å¤šæ—¶é—´ç²’åº¦ï¼ˆå®æ—¶ã€å°æ—¶ã€å¤©ï¼‰
- å¼‚å¸¸é«˜äº®
- å¯äº¤äº’ï¼ˆæ”¾å¤§ã€ç¼©å°ã€æ—¶é—´èŒƒå›´é€‰æ‹©ï¼‰
```

**4. çƒ­åŠ›å›¾**
```typescript
interface HeatmapData {
  xAxis: string[];  // IPåœ°å€
  yAxis: string[];  // ç«¯å£æˆ–æ—¶é—´æ®µ
  data: number[][];
}

// åŠŸèƒ½ï¼š
- IP-ç«¯å£è®¿é—®çƒ­åŠ›å›¾
- æ—¶é—´-æµé‡çƒ­åŠ›å›¾
- æ”»å‡»æ¥æºçƒ­åŠ›å›¾
```

---

## å››ã€æ¶æ„è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–

### 4.1 åˆ†å¸ƒå¼æ¶æ„è®¾è®¡

#### éƒ¨ç½²æ¨¡å¼

**1. å•æœºç‰ˆï¼ˆä¸­å°ä¼ä¸šï¼Œ< 1Gbpsï¼‰**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å•æœåŠ¡å™¨éƒ¨ç½²               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  é‡‡é›† + åˆ†æ + å­˜å‚¨ + Web  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é…ç½®è¦æ±‚ï¼š
- CPU: 8æ ¸+
- å†…å­˜: 32GB+
- å­˜å‚¨: 1TB+ SSD
```

**2. åˆ†å¸ƒå¼ç‰ˆï¼ˆå¤§å‹ä¼ä¸šï¼Œ> 1Gbpsï¼‰**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é‡‡é›†èŠ‚ç‚¹ 1   â”‚  â”‚ é‡‡é›†èŠ‚ç‚¹ 2   â”‚  â”‚ é‡‡é›†èŠ‚ç‚¹ N   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                 â”‚  Kafkaé›†ç¾¤   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ†æé›†ç¾¤    â”‚                 â”‚   å­˜å‚¨é›†ç¾¤       â”‚
â”‚ (å¤šä¸ªWorker) â”‚                 â”‚  ClickHouse      â”‚
â”‚              â”‚                 â”‚  Elasticsearch   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚  MinIO           â”‚
       â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚  WebæœåŠ¡é›†ç¾¤ â”‚
â”‚  (è´Ÿè½½å‡è¡¡)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒç»„ä»¶è®¾è®¡

**1. é‡‡é›†æ¢é’ˆé›†ç¾¤**
```go
package cluster

type AgentCluster struct {
    agents        map[string]*Agent
    loadBalancer  *LoadBalancer
    healthChecker *HealthChecker
}

type LoadBalancer struct {
    strategy string  // round-robin, least-conn, hash
}

func (lb *LoadBalancer) SelectAgent(task *Task) *Agent
func (lb *LoadBalancer) RebalanceTasks()

type HealthChecker struct {
    interval time.Duration
}

func (hc *HealthChecker) CheckHealth(agent *Agent) HealthStatus
func (hc *HealthChecker) HandleFailover(failedAgent *Agent)
```

**2. åˆ†æé›†ç¾¤**
```go
package analysis

type AnalysisCluster struct {
    workers       []*AnalysisWorker
    coordinator   *Coordinator
    taskQueue     *TaskQueue
}

type AnalysisWorker struct {
    id            string
    status        string
    currentTask   *Task
}

func (w *AnalysisWorker) ProcessTask(task *Task) error
func (w *AnalysisWorker) ReportStatus()

type Coordinator struct {
    workers       []*AnalysisWorker
    taskScheduler *TaskScheduler
}

func (c *Coordinator) AssignTask(task *Task) error
func (c *Coordinator) MonitorWorkers()
```

**3. é…ç½®ä¸­å¿ƒ**
```go
package config

type ConfigCenter struct {
    etcdClient *clientv3.Client
    cache      map[string]interface{}
}

func (c *ConfigCenter) GetConfig(key string) (interface{}, error)
func (c *ConfigCenter) SetConfig(key string, value interface{}) error
func (c *ConfigCenter) WatchConfig(key string) <-chan interface{}
func (c *ConfigCenter) RegisterService(service *ServiceInfo) error
func (c *ConfigCenter) DiscoverService(serviceName string) ([]*ServiceInfo, error)
```

---

### 4.2 æµ·é‡æ•°æ®å¤„ç†

#### æ•°æ®æµæ¶æ„
```
[é‡‡é›†Agent] â†’ [Kafka] â†’ [Flinkæµå¤„ç†] â†’ [å¤šçº§å­˜å‚¨]
                 â†“
         [å®æ—¶æ¶ˆè´¹è€…]
         (æ£€æµ‹/å‘Šè­¦)
```

#### Kafkaé›†æˆ
```go
package kafka

type KafkaProducer struct {
    producer  sarama.SyncProducer
    topic     string
    batchSize int
    buffer    [][]byte
}

func NewKafkaProducer(config *KafkaConfig) (*KafkaProducer, error)
func (p *KafkaProducer) Send(data []byte) error
func (p *KafkaProducer) SendBatch(batch [][]byte) error
func (p *KafkaProducer) Flush() error

type KafkaConsumer struct {
    consumer sarama.ConsumerGroup
    topics   []string
    handler  MessageHandler
}

type MessageHandler interface {
    HandleMessage(msg *sarama.ConsumerMessage) error
}

func NewKafkaConsumer(config *KafkaConfig) (*KafkaConsumer, error)
func (c *KafkaConsumer) Start() error
func (c *KafkaConsumer) Stop() error
```

#### å­˜å‚¨æ–¹æ¡ˆ

**1. ClickHouseï¼ˆç»“æ„åŒ–æ•°æ®ï¼‰**
```go
package storage

type ClickHouseClient struct {
    conn *sql.DB
}

// æµé‡æ•°æ®è¡¨
type FlowTable struct {
    Timestamp     time.Time
    SrcIP         string
    DstIP         string
    SrcPort       uint16
    DstPort       uint16
    Protocol      string
    ByteCount     uint64
    PacketCount   uint64
    Duration      uint32
}

// å‘Šè­¦æ•°æ®è¡¨
type AlertTable struct {
    Timestamp     time.Time
    AlertID       string
    RuleID        string
    Severity      string
    SrcIP         string
    DstIP         string
    Metadata      string  // JSON
}

func (c *ClickHouseClient) InsertFlows(flows []*FlowTable) error
func (c *ClickHouseClient) InsertAlerts(alerts []*AlertTable) error
func (c *ClickHouseClient) QueryFlows(query string) ([]*FlowTable, error)

// æ€§èƒ½ä¼˜åŒ–
func (c *ClickHouseClient) BatchInsert(table string, data []interface{}, batchSize int) error
func (c *ClickHouseClient) CreatePartitionTable(table string, partitionKey string)
```

**2. Elasticsearchï¼ˆå…¨æ–‡æ£€ç´¢ï¼‰**
```go
package storage

type ElasticsearchClient struct {
    client *elasticsearch.Client
}

func (e *ElasticsearchClient) IndexAlert(alert *Alert) error
func (e *ElasticsearchClient) SearchAlerts(query *SearchQuery) (*SearchResult, error)
func (e *ElasticsearchClient) AggregateAlerts(agg *Aggregation) (*AggResult, error)

// ç´¢å¼•ç®¡ç†
func (e *ElasticsearchClient) CreateIndex(name string, mapping map[string]interface{}) error
func (e *ElasticsearchClient) RolloverIndex(alias string) error
```

**3. MinIOï¼ˆå¯¹è±¡å­˜å‚¨ - PCAPï¼‰**
```go
package storage

type MinIOClient struct {
    client *minio.Client
    bucket string
}

func (m *MinIOClient) UploadPCAP(pcapID string, data io.Reader) error
func (m *MinIOClient) DownloadPCAP(pcapID string) (io.Reader, error)
func (m *MinIOClient) DeleteExpiredPCAPs(beforeDate time.Time) error

// ç”Ÿå‘½å‘¨æœŸç®¡ç†
func (m *MinIOClient) SetLifecyclePolicy(days int) error
```

#### æ•°æ®åˆ†å±‚å­˜å‚¨
```go
package storage

type TieredStorage struct {
    hotStorage  Storage  // SSD - æœ€è¿‘7å¤©
    warmStorage Storage  // HDD - æœ€è¿‘30å¤©
    coldStorage Storage  // å¯¹è±¡å­˜å‚¨ - 30å¤©ä»¥ä¸Š
}

func (s *TieredStorage) Write(data *Data) error
func (s *TieredStorage) Read(key string) (*Data, error)
func (s *TieredStorage) Migrate() error  // è‡ªåŠ¨è¿ç§»æ•°æ®
```

---

### 4.3 æ€§èƒ½ä¼˜åŒ–

#### é‡‡é›†æ€§èƒ½ä¼˜åŒ–
```go
package optimization

// é›¶æ‹·è´æŠ€æœ¯
type ZeroCopyCapture struct {
    ring *RingBuffer
}

func (z *ZeroCopyCapture) CapturePacket(packet []byte)

// æ‰¹é‡å¤„ç†
type BatchProcessor struct {
    batchSize     int
    flushInterval time.Duration
    buffer        []interface{}
}

func (p *BatchProcessor) Add(item interface{})
func (p *BatchProcessor) Flush() error

// å¹¶è¡Œå¤„ç†
type ParallelProcessor struct {
    workerCount int
    workQueue   chan *Task
}

func (p *ParallelProcessor) Process(tasks []*Task)
```

#### æ£€æµ‹æ€§èƒ½ä¼˜åŒ–
```go
package optimization

// è§„åˆ™é¢„è¿‡æ»¤
type RulePrefilter struct {
    ipIndex      map[string][]*Rule
    portIndex    map[uint16][]*Rule
    protocolIndex map[string][]*Rule
}

func (p *RulePrefilter) GetCandidateRules(packet *Packet) []*Rule

// æ¨¡å¼åŒ¹é…ä¼˜åŒ–
type OptimizedMatcher struct {
    acAutomaton  *ACAutomaton    // å¤šæ¨¡å¼åŒ¹é…
    bloomFilter  *BloomFilter    // å¿«é€Ÿæ’é™¤
}

// ç¼“å­˜ä¼˜åŒ–
type ResultCache struct {
    cache *lru.Cache
    ttl   time.Duration
}

func (c *ResultCache) Get(key string) (interface{}, bool)
func (c *ResultCache) Set(key string, value interface{})
```

#### æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
```go
package optimization

// æŸ¥è¯¢ç¼“å­˜
type QueryCache struct {
    redisClient *redis.Client
    ttl         time.Duration
}

func (c *QueryCache) GetCachedResult(query string) (interface{}, bool)
func (c *QueryCache) CacheResult(query string, result interface{})

// ç´¢å¼•ä¼˜åŒ–
type IndexOptimizer struct {
    clickhouse *ClickHouseClient
}

func (o *IndexOptimizer) CreateMaterializedView(query string) error
func (o *IndexOptimizer) AnalyzeQuery(query string) *QueryPlan
```

---

### 4.4 ç›‘æ§ä¸å¯è§‚æµ‹æ€§

```go
package monitoring

// PrometheusæŒ‡æ ‡
type MetricsCollector struct {
    registry *prometheus.Registry
}

type Metrics struct {
    // é‡‡é›†æŒ‡æ ‡
    PacketsPerSecond  prometheus.Counter
    BytesPerSecond    prometheus.Counter
    PacketDropRate    prometheus.Gauge
    
    // æ£€æµ‹æŒ‡æ ‡
    AlertsPerSecond   prometheus.Counter
    DetectionLatency  prometheus.Histogram
    RuleMatchRate     prometheus.Gauge
    
    // ç³»ç»ŸæŒ‡æ ‡
    CPUUsage          prometheus.Gauge
    MemoryUsage       prometheus.Gauge
    DiskUsage         prometheus.Gauge
    
    // ä¸šåŠ¡æŒ‡æ ‡
    ActiveAgents      prometheus.Gauge
    QueueDepth        prometheus.Gauge
    APILatency        prometheus.Histogram
}

func (m *MetricsCollector) RecordPackets(count int)
func (m *MetricsCollector) RecordAlert(severity string)
func (m *MetricsCollector) RecordLatency(duration time.Duration)

// å¥åº·æ£€æŸ¥
type HealthChecker struct {
    checks []HealthCheck
}

type HealthCheck interface {
    Check() HealthStatus
    GetName() string
}

func (h *HealthChecker) CheckAll() HealthStatus
```

---

## äº”ã€å•†ä¸šåŒ–è½åœ°è·¯çº¿

### 5.1 MVPäº§å“è®¾è®¡ï¼ˆ3ä¸ªæœˆå¿«é€Ÿä¸Šçº¿ï¼‰

#### ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ1ä¸ªæœˆï¼‰
```
ç›®æ ‡ï¼šå¯ç”¨çš„æ£€æµ‹ç³»ç»Ÿ

æ ¸å¿ƒæ¨¡å—ï¼š
1. é‡‡é›†Agentï¼ˆåŸºäºlibpcapï¼‰
   - å•æœºæŠ“åŒ…
   - Kafkaä¸ŠæŠ¥

2. æ£€æµ‹å¼•æ“ï¼ˆé›†æˆSuricataï¼‰
   - åŠ è½½è§„åˆ™
   - ç”Ÿæˆå‘Šè­¦

3. ç®€å•Webç•Œé¢
   - å‘Šè­¦åˆ—è¡¨
   - è§„åˆ™ç®¡ç†

æŠ€æœ¯é€‰å‹ï¼š
- åç«¯ï¼šGo + Gin + Suricata
- å‰ç«¯ï¼šReact + Ant Design
- å­˜å‚¨ï¼šPostgreSQL + MinIO
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šKafka
```

#### ç¬¬äºŒé˜¶æ®µï¼šå®Œå–„åŠŸèƒ½ï¼ˆ1ä¸ªæœˆï¼‰
```
ç›®æ ‡ï¼šå¯å–çš„äº§å“

æ–°å¢åŠŸèƒ½ï¼š
1. åˆ†å¸ƒå¼æ”¯æŒ
   - å¤šæ¢é’ˆç®¡ç†
   - ä¸­å¿ƒåŒ–åˆ†æ

2. æ•°æ®åˆ†æ
   - ClickHouseå­˜å‚¨
   - åŸºç¡€ç»Ÿè®¡åˆ†æ
   - æ•°æ®å¯è§†åŒ–

3. å¨èƒæƒ…æŠ¥
   - IOCå¯¼å…¥
   - æƒ…æŠ¥åŒ¹é…

4. ç”¨æˆ·ç³»ç»Ÿ
   - ç™»å½•è®¤è¯
   - æƒé™ç®¡ç†
```

#### ç¬¬ä¸‰é˜¶æ®µï¼šäº§å“åŒ–æ‰“ç£¨ï¼ˆ1ä¸ªæœˆï¼‰
```
ç›®æ ‡ï¼šå¥½ç”¨çš„äº§å“

ä¼˜åŒ–å†…å®¹ï¼š
1. ç”¨æˆ·ä½“éªŒ
   - ç›‘æ§å¤§å±
   - äº¤äº’ä¼˜åŒ–
   - å“åº”é€Ÿåº¦

2. ç¨³å®šæ€§
   - å¼‚å¸¸å¤„ç†
   - å®¹é”™æœºåˆ¶
   - æ€§èƒ½ä¼˜åŒ–

3. å¯ç»´æŠ¤æ€§
   - æ—¥å¿—ç³»ç»Ÿ
   - ç›‘æ§å‘Šè­¦
   - æ–‡æ¡£å®Œå–„
```

---

### 5.2 æŠ€æœ¯é€‰å‹å»ºè®®

#### å¿«é€ŸåŸå‹é˜¶æ®µ
```
åç«¯ï¼šGo + Ginæ¡†æ¶
å‰ç«¯ï¼šReact + TypeScript + Ant Design
æ£€æµ‹å¼•æ“ï¼šSuricataï¼ˆç°æˆæ–¹æ¡ˆï¼‰
åè®®è¯†åˆ«ï¼šnDPIåº“
æ¶ˆæ¯é˜Ÿåˆ—ï¼šKafka
æ•°æ®åº“ï¼šPostgreSQLï¼ˆå°è§„æ¨¡ï¼‰
å¯¹è±¡å­˜å‚¨ï¼šMinIO
```

#### ç”Ÿäº§çº§ç³»ç»Ÿ
```
åç«¯ï¼šGo + gRPCå¾®æœåŠ¡
å‰ç«¯ï¼šReact + TypeScript + è‡ªå®šä¹‰ç»„ä»¶
æ£€æµ‹å¼•æ“ï¼šSuricata + è‡ªç ”è§„åˆ™å¼•æ“
æµé‡åˆ†æï¼šZeek + è‡ªç ”DPI
æ¶ˆæ¯é˜Ÿåˆ—ï¼šKafkaé›†ç¾¤
OLAPæ•°æ®åº“ï¼šClickHouseé›†ç¾¤
æœç´¢å¼•æ“ï¼šElasticsearché›†ç¾¤
å¯¹è±¡å­˜å‚¨ï¼šMinIOé›†ç¾¤/Ceph
ç¼“å­˜ï¼šRedisé›†ç¾¤
ç›‘æ§ï¼šPrometheus + Grafana
```

---

### 5.3 ç«å“åˆ†æä¸å·®å¼‚åŒ–

#### å›½é™…äº§å“å¯¹æ ‡
```
1. Darktrace
   - ç‰¹ç‚¹ï¼šAIé©±åŠ¨çš„å¼‚å¸¸æ£€æµ‹
   - ä»·æ ¼ï¼šé«˜ç«¯ï¼ˆç™¾ä¸‡çº§ï¼‰
   - å·®å¼‚åŒ–ï¼šè½»é‡çº§AIæ£€æµ‹

2. ExtraHop
   - ç‰¹ç‚¹ï¼šæµé‡åˆ†æ+APM
   - ä»·æ ¼ï¼šä¸­é«˜ç«¯
   - å·®å¼‚åŒ–ï¼šä¸“æ³¨ç½‘ç»œå®‰å…¨

3. Vectra
   - ç‰¹ç‚¹ï¼šNDRå¹³å°
   - ä»·æ ¼ï¼šä¸­é«˜ç«¯
   - å·®å¼‚åŒ–ï¼šå¼€æº+å•†ä¸šåŒ–æ··åˆ
```

#### å›½å†…äº§å“å¯¹æ ‡
```
1. ç»¿ç›Ÿç§‘æŠ€ - å…¥ä¾µæ£€æµ‹
2. å¥‡å®‰ä¿¡ - å¤©çœ¼
3. æ·±ä¿¡æœ - å®‰å…¨æ„ŸçŸ¥å¹³å°
4. å®‰æ’ä¿¡æ¯ - æ˜å¾¡APT

å·®å¼‚åŒ–æ–¹å‘ï¼š
- æ›´çµæ´»çš„éƒ¨ç½²æ–¹å¼ï¼ˆäº‘åŸç”Ÿï¼‰
- æ›´å¼€æ”¾çš„æ¶æ„ï¼ˆAPIä¼˜å…ˆï¼‰
- æ›´å‹å¥½çš„ä»·æ ¼ï¼ˆä¸­å°ä¼ä¸šï¼‰
- å‚ç›´è¡Œä¸šå®šåˆ¶ï¼ˆé‡‘è/å·¥æ§ï¼‰
```

#### å·®å¼‚åŒ–åŠŸèƒ½å»ºè®®
```
1. ä¸œè¥¿å‘æµé‡ç›‘æ§
   - å†…ç½‘æ¨ªå‘ç§»åŠ¨æ£€æµ‹
   - æ•°æ®ä¸­å¿ƒæµé‡åˆ†æ

2. APIæµé‡å®‰å…¨
   - APIèµ„äº§å‘ç°
   - APIå¼‚å¸¸æ£€æµ‹
   - APIæ”»å‡»é˜²æŠ¤

3. å®¹å™¨/äº‘ç¯å¢ƒ
   - K8sæµé‡ç›‘æ§
   - æœåŠ¡ç½‘æ ¼é›†æˆ
   - äº‘APIå®¡è®¡

4. è½»é‡åŒ–éƒ¨ç½²
   - æ— Agentæ–¹æ¡ˆ
   - è¾¹ç¼˜è®¡ç®—æ”¯æŒ
   - ä½èµ„æºå ç”¨
```

---

### 5.4 å®æˆ˜é¡¹ç›®æ¨è

#### é¡¹ç›®ä¸€ï¼šä¼ä¸šçº§IDSç®¡ç†å¹³å°
```
åŠŸèƒ½èŒƒå›´ï¼š
- Suricataé›†ç¾¤ç®¡ç†
- ç»Ÿä¸€è§„åˆ™ç®¡ç†
- å‘Šè­¦ä¸­å¿ƒ
- æŠ¥è¡¨ç³»ç»Ÿ

é€‚ç”¨åœºæ™¯ï¼šä¸­å°ä¼ä¸šç½‘ç»œå®‰å…¨
å¼€å‘å‘¨æœŸï¼š2-3ä¸ªæœˆ
å•†ä¸šåŒ–éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜†
```

#### é¡¹ç›®äºŒï¼šæµé‡å¨èƒæ£€æµ‹ç³»ç»Ÿ
```
åŠŸèƒ½èŒƒå›´ï¼š
- å¤šæ¢é’ˆæµé‡é‡‡é›†
- DPIæ·±åº¦åˆ†æ
- å¨èƒæƒ…æŠ¥é›†æˆ
- å®æ—¶æ£€æµ‹å‘Šè­¦
- å†å²æ•°æ®åˆ†æ

é€‚ç”¨åœºæ™¯ï¼šå¤§å‹ä¼ä¸šã€è¿è¥å•†
å¼€å‘å‘¨æœŸï¼š4-6ä¸ªæœˆ
å•†ä¸šåŒ–éš¾åº¦ï¼šâ˜…â˜…â˜…â˜…â˜†
```

#### é¡¹ç›®ä¸‰ï¼šäº‘ç¯å¢ƒæµé‡å®¡è®¡
```
åŠŸèƒ½èŒƒå›´ï¼š
- VPCæµé‡é•œåƒ
- äº‘APIè°ƒç”¨åˆ†æ
- å®¹å™¨æµé‡ç›‘æ§
- åˆè§„æ€§å®¡è®¡

é€‚ç”¨åœºæ™¯ï¼šäº‘åŸç”Ÿä¼ä¸š
å¼€å‘å‘¨æœŸï¼š3-4ä¸ªæœˆ
å•†ä¸šåŒ–éš¾åº¦ï¼šâ˜…â˜…â˜…â˜†â˜†
```

#### é¡¹ç›®å››ï¼šAPIå®‰å…¨åˆ†æå¹³å°
```
åŠŸèƒ½èŒƒå›´ï¼š
- APIèµ„äº§è‡ªåŠ¨å‘ç°
- APIè°ƒç”¨åˆ†æ
- APIå¼‚å¸¸æ£€æµ‹
- APIæ”»å‡»é˜²æŠ¤

é€‚ç”¨åœºæ™¯ï¼šäº’è”ç½‘å…¬å¸ã€é‡‘èç§‘æŠ€
å¼€å‘å‘¨æœŸï¼š3-4ä¸ªæœˆ
å•†ä¸šåŒ–éš¾åº¦ï¼šâ˜…â˜…â˜…â˜…â˜†
```

---

## å…­ã€æŠ€æœ¯æ ˆæ€»è§ˆ

### ç¼–ç¨‹è¯­è¨€
- **ä¸»åŠ›è¯­è¨€**ï¼šGolangï¼ˆé«˜æ€§èƒ½ã€å¹¶å‘ã€éƒ¨ç½²æ–¹ä¾¿ï¼‰
- **è¾…åŠ©è¯­è¨€**ï¼šPythonï¼ˆæ•°æ®åˆ†æã€ç®—æ³•åŸå‹ï¼‰

### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**ï¼šReact 18 + TypeScript
- **UIç»„ä»¶**ï¼šAnt Design / Material-UI
- **çŠ¶æ€ç®¡ç†**ï¼šRedux Toolkit / Zustand
- **å›¾è¡¨**ï¼šECharts / Recharts
- **ç½‘ç»œå›¾**ï¼šG6 / Cytoscape.js
- **è¡¨æ ¼**ï¼šag-Grid

### åç«¯æŠ€æœ¯
- **Webæ¡†æ¶**ï¼šGin / Echo / Fiber
- **RPCæ¡†æ¶**ï¼šgRPC
- **ç½‘ç»œåº“**ï¼šgopacket / libpcap
- **HTTPå®¢æˆ·ç«¯**ï¼šresty / go-resty

### æ•°æ®å­˜å‚¨
- **OLAPæ•°æ®åº“**ï¼šClickHouseï¼ˆæµé‡æ•°æ®ã€ç»Ÿè®¡ï¼‰
- **å…³ç³»æ•°æ®åº“**ï¼šPostgreSQLï¼ˆé…ç½®ã€ç”¨æˆ·ï¼‰
- **æœç´¢å¼•æ“**ï¼šElasticsearchï¼ˆå‘Šè­¦ã€æ—¥å¿—ï¼‰
- **ç¼“å­˜**ï¼šRedisï¼ˆä¼šè¯ã€ç¼“å­˜ï¼‰
- **å¯¹è±¡å­˜å‚¨**ï¼šMinIOï¼ˆPCAPæ–‡ä»¶ï¼‰

### ä¸­é—´ä»¶
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šKafkaï¼ˆæ•°æ®ç®¡é“ï¼‰

### æ£€æµ‹å¼•æ“
- **IDS**ï¼šSuricataï¼ˆè§„åˆ™æ£€æµ‹ï¼‰
- **æµé‡åˆ†æ**ï¼šZeekï¼ˆåè®®è§£æï¼‰
- **åè®®è¯†åˆ«**ï¼šnDPIï¼ˆDPIï¼‰

### ç›‘æ§è¿ç»´
- **ç›‘æ§**ï¼šPrometheus + Grafana
- **æ—¥å¿—**ï¼šZap / Logrus
- **è¿½è¸ª**ï¼šJaegerï¼ˆåˆ†å¸ƒå¼è¿½è¸ªï¼‰

### å¼€å‘å·¥å…·
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šGit
- **æ¥å£æ–‡æ¡£**ï¼šSwagger / OpenAPI
- **æµ‹è¯•**ï¼šGo testing / testify
- **æ€§èƒ½åˆ†æ**ï¼špprof

---

## ä¸ƒã€å­¦ä¹ è·¯å¾„å»ºè®®

### é˜¶æ®µä¸€ï¼šæŠ€æœ¯å‚¨å¤‡ï¼ˆ1-2ä¸ªæœˆï¼‰

**ç½‘ç»œç¼–ç¨‹æ·±å…¥**
- libpcapç¼–ç¨‹
- é›¶æ‹·è´æŠ€æœ¯
- é«˜æ€§èƒ½ç½‘ç»œIO

**Goè¯­è¨€è¿›é˜¶**
- å¹¶å‘ç¼–ç¨‹ï¼ˆgoroutineã€channelï¼‰
- æ€§èƒ½ä¼˜åŒ–ï¼ˆpprofã€traceï¼‰
- ç½‘ç»œç¼–ç¨‹ï¼ˆgopacketï¼‰

**å¼€æºé¡¹ç›®ç ”ç©¶**
- Suricataæºç é˜…è¯»
- Zeekæ¶æ„å­¦ä¹ 
- Moloch/Arkimeéƒ¨ç½²

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ˆ2-3ä¸ªæœˆï¼‰

**é‡‡é›†æ¨¡å—**
- å®ç°é«˜æ€§èƒ½æŠ“åŒ…
- Kafkaé›†æˆ
- æ€§èƒ½ç›‘æ§

**æ£€æµ‹æ¨¡å—**
- é›†æˆSuricata
- è§„åˆ™ç®¡ç†ç³»ç»Ÿ
- å‘Šè­¦ç”Ÿæˆ

**å­˜å‚¨æ¨¡å—**
- ClickHouseå»ºæ¨¡
- æ•°æ®å†™å…¥ä¼˜åŒ–
- æŸ¥è¯¢ä¼˜åŒ–

### é˜¶æ®µä¸‰ï¼šäº§å“åŒ–ï¼ˆ2-3ä¸ªæœˆï¼‰

**å‰ç«¯å¼€å‘**
- Reactç»„ä»¶å¼€å‘
- æ•°æ®å¯è§†åŒ–
- å®æ—¶æ¨é€

**åç«¯API**
- RESTful APIè®¾è®¡
- è®¤è¯æˆæƒ
- æ€§èƒ½ä¼˜åŒ–

**ç³»ç»Ÿé›†æˆ**
- æ¨¡å—è”è°ƒ
- æ€§èƒ½æµ‹è¯•
- å®‰å…¨åŠ å›º

### é˜¶æ®µå››ï¼šé«˜çº§ç‰¹æ€§ï¼ˆ2-3ä¸ªæœˆï¼‰

**åˆ†å¸ƒå¼æ¶æ„**
- å¤šèŠ‚ç‚¹éƒ¨ç½²
- è´Ÿè½½å‡è¡¡
- æ•…éšœè½¬ç§»

**é«˜çº§æ£€æµ‹**
- å¨èƒæƒ…æŠ¥é›†æˆ
- è¡Œä¸ºåˆ†æ
- æœºå™¨å­¦ä¹ 

**æ€§èƒ½ä¼˜åŒ–**
- å¤§æµé‡å¤„ç†
- å­˜å‚¨ä¼˜åŒ–
- æŸ¥è¯¢åŠ é€Ÿ

### é˜¶æ®µäº”ï¼šå•†ä¸šåŒ–ï¼ˆæŒç»­ï¼‰

**äº§å“æ‰“ç£¨**
- ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- åŠŸèƒ½å®Œå–„
- æ–‡æ¡£ç¼–å†™

**å¸‚åœºæ¨å¹¿**
- Demoç¯å¢ƒæ­å»º
- æŠ€æœ¯åšå®¢
- å¼€æºé¡¹ç›®å‘å¸ƒ

---

## å…«ã€å…³é”®æŠ€æœ¯éš¾ç‚¹

### 8.1 é«˜æ€§èƒ½æµé‡é‡‡é›†
```
æŒ‘æˆ˜ï¼š
- 10Gbps+ç½‘ç»œç¯å¢ƒä¸‹çš„é›¶ä¸¢åŒ…
- å¤šæ ¸CPUåˆ©ç”¨ç‡
- å†…å­˜ç®¡ç†

è§£å†³æ–¹æ¡ˆï¼š
- AF_PACKET TPACKET_V3
- PF_RING / DPDK
- é›¶æ‹·è´æŠ€æœ¯
- CPUäº²å’Œæ€§ç»‘å®š
```

### 8.2 è§„åˆ™æ€§èƒ½ä¼˜åŒ–
```
æŒ‘æˆ˜ï¼š
- ä¸‡çº§è§„åˆ™ä¸‹çš„åŒ¹é…æ€§èƒ½
- å¤æ‚æ­£åˆ™çš„æ€§èƒ½å½±å“

è§£å†³æ–¹æ¡ˆï¼š
- ACè‡ªåŠ¨æœºå¤šæ¨¡å¼åŒ¹é…
- è§„åˆ™åˆ†ç»„ä¸é¢„è¿‡æ»¤
- PCREä¼˜åŒ–
- GPUåŠ é€Ÿï¼ˆå¯é€‰ï¼‰
```

### 8.3 æµ·é‡æ•°æ®å­˜å‚¨
```
æŒ‘æˆ˜ï¼š
- TBçº§æ•°æ®çš„å¿«é€Ÿå†™å…¥
- ç§’çº§æŸ¥è¯¢å“åº”
- å­˜å‚¨æˆæœ¬æ§åˆ¶

è§£å†³æ–¹æ¡ˆï¼š
- ClickHouseåˆ†åŒºè¡¨
- æ•°æ®åˆ†å±‚å­˜å‚¨
- å†·çƒ­æ•°æ®åˆ†ç¦»
- å‹ç¼©ç®—æ³•ä¼˜åŒ–
```

### 8.4 å®æ—¶åˆ†ææ€§èƒ½
```
æŒ‘æˆ˜ï¼š
- ç™¾ä¸‡çº§æµé‡çš„å®æ—¶å¤„ç†
- æ¯«ç§’çº§æ£€æµ‹å»¶è¿Ÿ

è§£å†³æ–¹æ¡ˆï¼š
- æµå¼å¤„ç†ï¼ˆKafka+Flinkï¼‰
- å¹¶è¡Œåˆ†æ
- å¢é‡è®¡ç®—
- ç»“æœç¼“å­˜
```

---

## é™„å½•ï¼šæ ¸å¿ƒä»£ç ç»“æ„ç¤ºä¾‹

```
network-security-platform/
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ agent/          # é‡‡é›†Agent
â”‚   â”œâ”€â”€ analyzer/       # åˆ†ææœåŠ¡
â”‚   â”œâ”€â”€ api/            # APIæœåŠ¡
â”‚   â””â”€â”€ cli/            # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ capture/        # æµé‡é‡‡é›†
â”‚   â”œâ”€â”€ parser/         # åè®®è§£æ
â”‚   â”œâ”€â”€ detection/      # æ£€æµ‹å¼•æ“
â”‚   â”œâ”€â”€ correlation/    # äº‹ä»¶å…³è”
â”‚   â”œâ”€â”€ intel/          # å¨èƒæƒ…æŠ¥
â”‚   â”œâ”€â”€ storage/        # å­˜å‚¨æ¥å£
â”‚   â”œâ”€â”€ query/          # æŸ¥è¯¢æœåŠ¡
â”‚   â””â”€â”€ common/         # å…¬å…±ç»„ä»¶
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/         # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â””â”€â”€ models/         # æ•°æ®æ¨¡å‹
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ rest/           # REST APIå®šä¹‰
â”‚   â””â”€â”€ grpc/           # gRPCå®šä¹‰
â”œâ”€â”€ web/                # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/ # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/      # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ services/   # APIè°ƒç”¨
â”‚   â”‚   â””â”€â”€ utils/      # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ public/
â”œâ”€â”€ configs/            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ deployments/        # éƒ¨ç½²é…ç½®
â”œâ”€â”€ scripts/            # è„šæœ¬
â”œâ”€â”€ docs/               # æ–‡æ¡£
â””â”€â”€ tests/              # æµ‹è¯•
```

---

## æ€»ç»“

æœ¬å¤§çº²ä»¥**å·¥ç¨‹åŒ–è½åœ°**ä¸ºæ ¸å¿ƒï¼Œæ¶µç›–äº†ä»æµé‡é‡‡é›†åˆ°äº§å“åŒ–çš„å®Œæ•´æŠ€æœ¯æ ˆã€‚é€šè¿‡3-12ä¸ªæœˆçš„ç³»ç»Ÿå­¦ä¹ å’Œå®è·µï¼Œå¯ä»¥æŒæ¡ç½‘ç»œå®‰å…¨äº§å“å¼€å‘çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå¹¶å…·å¤‡å•†ä¸šåŒ–è½åœ°çš„å®æˆ˜ç»éªŒã€‚

**æ ¸å¿ƒç«äº‰åŠ›ï¼š**
1. æ·±å…¥ç†è§£ç½‘ç»œæµé‡åˆ†ææŠ€æœ¯
2. æŒæ¡é«˜æ€§èƒ½ç³»ç»Ÿæ¶æ„è®¾è®¡
3. å…·å¤‡å®Œæ•´äº§å“å¼€å‘èƒ½åŠ›
4. ç†è§£å•†ä¸šåŒ–è½åœ°è·¯å¾„

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼š**
1. é€‰æ‹©ä¸€ä¸ªå®æˆ˜é¡¹ç›®å¼€å§‹
2. æ­å»ºå¼€å‘ç¯å¢ƒ
3. æ·±å…¥ç ”ç©¶ä¸€ä¸ªå¼€æºé¡¹ç›®
4. å®ç°MVPç‰ˆæœ¬
5. æŒç»­è¿­ä»£ä¼˜åŒ–

