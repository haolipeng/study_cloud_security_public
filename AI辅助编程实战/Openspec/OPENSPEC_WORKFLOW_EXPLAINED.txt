═══════════════════════════════════════════════════════════════════
  OpenSpec 完整工作流程图解
═══════════════════════════════════════════════════════════════════

阶段 1: PROPOSAL (提案)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

创建目录和文件：
  openspec/changes/add-control-plane-api/
  ├── proposal.md         ← 为什么、改什么、影响
  ├── design.md           ← 技术设计、架构决策
  ├── tasks.md            ← 实施任务清单
  └── specs/              ← 规范增量（delta）
      ├── control-plane-api/
      │   └── spec.md     ← ADDED Requirements (新需求)
      └── policy-management/
          └── spec.md     ← ADDED Requirements (新需求)

命令: openspec validate add-control-plane-api --strict
状态: openspec list 显示 "add-control-plane-api  0/93 tasks"

─────────────────────────────────────────────────────────────────

阶段 2: APPLY (实施)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

位置不变，还在 changes/add-control-plane-api/

执行任务：
  1. 按照 tasks.md 逐项完成
  2. 编写代码：src/agent/pkg/api/...
  3. 更新 tasks.md: [ ] → [x]

命令: /openspec-apply add-control-plane-api
状态: openspec list 显示 "add-control-plane-api  45/93 tasks"
                                               ↑ 进度更新

─────────────────────────────────────────────────────────────────

阶段 3: ARCHIVE (归档)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

命令: openspec archive add-control-plane-api --yes

操作 A: 移动文档到 archive/
  changes/add-control-plane-api/
    ↓ 移动
  changes/archive/2025-10-30-add-control-plane-api/
  ├── proposal.md
  ├── design.md
  └── tasks.md (全部 [x])

操作 B: 合并 spec 增量到 specs/ (真相)
  changes/.../specs/control-plane-api/spec.md
    ↓ ADDED Requirements 合并到
  specs/control-plane-api/spec.md  ← 新建完整规范

  changes/.../specs/policy-management/spec.md
    ↓ ADDED Requirements 合并到
  specs/policy-management/spec.md  ← 新建完整规范

结果:
  ✅ changes/add-control-plane-api/ 已移除
  ✅ archive/2025-10-30-add-control-plane-api/ 已创建
  ✅ specs/control-plane-api/ 已创建（系统真相）
  ✅ specs/policy-management/ 已创建（系统真相）

状态: openspec list 显示 "No active changes found."
      openspec list --specs 显示新的规范

═══════════════════════════════════════════════════════════════════
  关键理解
═══════════════════════════════════════════════════════════════════

changes/  = 工作区（正在做什么）   📝
specs/    = 真相源（已经有什么）   ✅
archive/  = 历史库（做过什么）     📚

changes/ 下的 specs/ 是增量（delta）
specs/ 下的 spec.md 是完整规范（truth）

═══════════════════════════════════════════════════════════════════
