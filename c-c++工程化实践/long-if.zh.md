# ä½¿ç”¨åˆ†æ”¯è¡¨ç®€åŒ–if-elseé€»è¾‘

## ç¤ºä¾‹åœºæ™¯

å‡è®¾æœ‰ä¸€ä¸ªç¨‹åºéœ€è¦å¤„ç†ç”¨æˆ·è¾“å…¥çš„(a, b, c, d, e)å‘½ä»¤å¹¶æ‰§è¡Œç›¸åº”æ“ä½œï¼Œä¼ ç»Ÿå®ç°å¦‚ä¸‹ï¼š

```
if cmd == â€˜aâ€™
	do_something_for_a();
else if cmd == â€˜bâ€™
	do_something_for_b();
......(skip)
else
	do_error();
```

ä¸€ä¸ªif-elseåˆ†æ”¯å¤„ç†ä¸€ä¸ªå‘½ä»¤ï¼Œç„¶åæœ€åä¸€ä¸ªelseè¯­å¥æ˜¯å¤„ç†é”™è¯¯æƒ…å†µçš„ã€‚
è®©æˆ‘ä»¬æ¨¡æ‹Ÿä¸‹çœŸå®åœºæ™¯ï¼š

```c
#include <stdio.h>
#include <unistd.h>

int long_if(char cmd)
{
	int ret;

	switch (cmd) {
	case 'a':
		printf("command is a\n");
		/* code for command a */
		ret = 1;
		break;
	case 'b':
		printf("command is b\n");
		/* code for command a */
		ret = 2;
		break;
	case 'c':
		printf("command is c\n");
		/* code for command a */
		ret = 3;
		break;
	case 'd':
		printf("command is d\n");
		/* code for command a */
		ret = 4;
		break;
	case 'e':
		printf("command is e\n");
		/* code for command a */
		ret = 5;
		break;
    //åç»­è¿™é‡Œè¿˜ä¼šæ·»åŠ å¾ˆå¤šå…¶ä»–çš„å‘½ä»¤
	default:
		printf("Unidentified command\n");
		/* code for error */
		ret = -1;
		break;
	}
	return ret;
}


int main(int argc, char *argv[])
{
	char cmd;

	if (argc != 2) {
		printf("usage: ./a.out command(a|b|c|d|e)\n");
		return 1;
	}

	printf("result=%d\n", long_if((char)argv[1][0]));
	return 0;
}
```

è¿™ä¸ª long-if å‡½æ•°æ˜¯ç”¨æ¥å¤„ç†ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤çš„ã€‚å¾ˆå¤šæœ‰ç»éªŒçš„ç¨‹åºå‘˜å–œæ¬¢ç”¨ switch-case æ¥å†™è¿™ç§é€»è¾‘ï¼Œä½†å…¶å®å®ƒå’Œ if-else ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸€ä¸ªä¸ªåˆ¤æ–­å‘½ä»¤è¯¥æ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚

ä»£ç é•¿ä¸€ç‚¹å€’ä¸æ˜¯å¤§é—®é¢˜ï¼Œé—®é¢˜æ˜¯ç¨‹åºä»¥åå¯èƒ½è¦ç»å¸¸æ”¹åŠ¨ï¼š

- å¯èƒ½è¦å¢åŠ æ–°å‘½ä»¤
- å‘½ä»¤çš„æ ¼å¼å¯èƒ½ä¼šå˜ï¼ˆæ¯”å¦‚ä»å­—æ¯a/b/cæ”¹æˆæ•°å­—1/2/3ï¼‰
- ä¸šåŠ¡é€»è¾‘å¯èƒ½è¦è°ƒæ•´ï¼Œæ¯”å¦‚æ¯ä¸ªå‘½ä»¤çš„å¤„ç†å‡½æ•°

æ¯æ¬¡ä¿®æ”¹éƒ½è¦æŠŠæ•´ä¸ª if-else æˆ–è€… switch-case çœ‹ä¸€éï¼Œæ‰¾åˆ°éœ€è¦æ”¹çš„åœ°æ–¹ã€‚æœ‰æ—¶å€™è¦æ”¹å¾ˆå¤šå¤„ï¼Œæœ‰æ—¶å€™è¿˜è¦åŠ æ–°çš„åˆ¤æ–­ã€‚

æœ€éº»çƒ¦çš„æ˜¯ï¼Œéšç€ç¨‹åºåŠŸèƒ½è¶Šæ¥è¶Šå¤šï¼Œè¿™äº›åˆ¤æ–­ä¼šå˜å¾—è¶Šæ¥è¶Šé•¿ã€‚ç­‰æœ‰å‡ åä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œæ”¹èµ·æ¥å°±ç‰¹åˆ«å®¹æ˜“å‡ºé”™ï¼Œè€Œä¸”å¾ˆèŠ±æ—¶é—´ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›´å¥½çš„å†™æ³•...



ç°åœ¨æˆ‘è¦ä»‹ç»ä¸€ç§"**æ•°æ®å’Œé€»è¾‘åˆ†ç¦»**"çš„æŠ€å·§ï¼š

- **æ•°æ®**ï¼šæŒ‡é‚£äº›ç»å¸¸å˜åŒ–çš„å¤–éƒ¨è¾“å…¥ï¼ˆæ¯”å¦‚ç”¨æˆ·å‘½ä»¤ï¼‰
- **é€»è¾‘**ï¼šå¤„ç†æ•°æ®çš„ç¨‹åºä»£ç ï¼ˆé€šå¸¸æ¯”è¾ƒå›ºå®šï¼‰

å…·ä½“æ¥è¯´ï¼š

- **æ•°æ®éƒ¨åˆ†**ï¼šç”¨æˆ·çš„å„ç§å‘½ä»¤
- **é€»è¾‘éƒ¨åˆ†**ï¼šå¤„ç†è¿™äº›å‘½ä»¤çš„ç¨‹åºä»£ç 

æ€ä¹ˆå®ç°åˆ†ç¦»å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è¿™æ ·ç»„ç»‡æ•°æ®ï¼š

- (a, å¤„ç†å‡½æ•°_a)
- (b, å¤„ç†å‡½æ•°_b)
- (c, å¤„ç†å‡½æ•°_c)
- (d, å¤„ç†å‡½æ•°_d)
- (e, å¤„ç†å‡½æ•°_e)

è¿™æ ·å°±å»ºç«‹äº†ä¸€ä¸ª"å‘½ä»¤-å¤„ç†å‡½æ•°"çš„å¯¹åº”è¡¨ã€‚æœ€åæˆ‘ä»¬åªéœ€è¦å†™ä¸€ä¸ªé€šç”¨çš„å¤„ç†é€»è¾‘ï¼š

```
for each pair in the list
	if user's command == command in the pair
		call handler in the pair
```

è¿™æ®µæ ¸å¿ƒä»£ç å‡ ä¹æ°¸è¿œä¸éœ€è¦ä¿®æ”¹ã€‚
å°±ç®—ä»¥åè¦æ–°å¢å‘½ä»¤ã€åˆ é™¤å‘½ä»¤ï¼Œæˆ–è€…è°ƒæ•´åŠŸèƒ½éœ€æ±‚ï¼Œ
ä¸Šé¢çš„å¤„ç†é€»è¾‘éƒ½å®Œå…¨ä¸ç”¨åŠ¨ã€‚

ä¸‹é¢æˆ‘ç”¨å…·ä½“ä»£ç æ¥æ¼”ç¤ºå¦‚ä½•å®ç°è¿™ç§åˆ†ç¦»ï¼š

```c
static int handler_a(char cmd)
{
	printf("command is a\n");
	return cmd - 'a' + 1;
};

static int handler_b(char cmd)
{
	printf("command is b\n");
	return cmd - 'a' + 1;
};

static int handler_c(char cmd)
{
	printf("command is c\n");
	return cmd - 'a' + 1;
};

static int handler_d(char cmd)
{
	printf("command is d\n");
	return cmd - 'a' + 1;
};

static int handler_e(char cmd)
{
	printf("command is e\n");
	return cmd - 'a' + 1;
};

//å‘½ä»¤è¡Œå¤„ç†å™¨
struct cmd_handler {
	char cmd;//å…·ä½“å‘½ä»¤
	int (*handler)(char);//å‘½ä»¤å¤„ç†å‡½æ•°
};

int short_if(char cmd)
{
	int i;
	int ret = -1;
    //å®šä¹‰æ‰€æœ‰å‘½ä»¤çš„åˆé›†
	struct cmd_handler chandlers[] = {
		{'a', handler_a},
		{'b', handler_b},
		{'c', handler_c},
		{'d', handler_d},
		{'e', handler_e}
    };
	
	for (i = 0; i < sizeof(chandlers)/sizeof(chandlers[0]); i++) {
        //éå†æ¯ä¸ªå‘½ä»¤å¹¶è°ƒç”¨å…¶å¤„ç†å‡½æ•°
		if (chandlers[i].cmd == cmd) {
			ret = chandlers[i].handler(chandlers[i].cmd);
			break;
		}
	}

	if (ret < 0)
		printf("Unidentified command\n");
	return ret;
}
```

æˆ‘æŠŠåŸæ¥çš„ long_if æ›¿æ¢æˆäº† short_ifã€‚è¿™ä¸ª short_if æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼šæŠŠä¼šå˜åŠ¨çš„éƒ¨åˆ†éƒ½æ•´ç†æˆäº†æ¸…æ™°çš„æ•°æ®ç»“æ„ã€‚

å…·ä½“æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ

1. å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ struct cmd_handlerï¼Œç”¨æ¥å­˜ï¼š
   - å‘½ä»¤æ˜¯ä»€ä¹ˆï¼ˆæ¯”å¦‚å­—æ¯a/b/cï¼‰
   - å¯¹åº”çš„å¤„ç†å‡½æ•°æ˜¯ä»€ä¹ˆ
2. ç„¶åæŠŠæ‰€æœ‰å‘½ä»¤å’Œå¤„ç†å‡½æ•°çš„å¯¹åº”å…³ç³»ï¼Œç”¨ä¸€ä¸ªæ•°ç»„å­˜èµ·æ¥ï¼š

```
struct cmd_handler chandlers[] = {
		{'a', handler_a},
		{'b', handler_b},
		{'c', handler_c},
		{'d', handler_d},
		{'e', handler_e}
    };
```

è¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ

â• è¦åŠ æ–°å‘½ä»¤ï¼Ÿåªéœ€è¦åœ¨æ•°ç»„é‡ŒåŠ ä¸€è¡Œå¯¹åº”å…³ç³»

âœ‚ï¸ è¦åˆ å‘½ä»¤ï¼Ÿç›´æ¥åˆ æ‰æ•°ç»„é‡Œå¯¹åº”çš„é‚£è¡Œ

ğŸ”„ è¦æ”¹å‘½ä»¤ï¼Ÿä¹Ÿåªéœ€è¦ä¿®æ”¹æ•°ç»„é‡Œçš„å¯¹åº”å…³ç³»

ä¸ç®¡æ€ä¹ˆæ”¹ï¼Œéƒ½åªéœ€è¦åŠ¨è¿™ä¸ªæ•°ç»„ï¼Œæ ¸å¿ƒçš„å¤„ç†é€»è¾‘å®Œå…¨ä¸ç”¨ç¢°ã€‚



å¯èƒ½æœ‰äº›å°ä¼™ä¼´ä¼šè§‰å¾—ï¼š"è¿™æ ·å†™ä»£ç ä¸æ˜¯æ›´å¤æ‚äº†å—ï¼Ÿ"

ä½†æˆ‘ä»¬è¦è®°ä½ï¼š
1ï¸âƒ£ ç¨‹åºæ˜¯è¦é•¿æœŸç»´æŠ¤çš„
2ï¸âƒ£ åŠŸèƒ½åªä¼šè¶Šæ¥è¶Šå¤š

ğŸ‘‰ ç°åœ¨éœ€æ±‚å¯èƒ½æ˜¯å¤„ç†a/b/c/d/eè¿™å‡ ä¸ªå‘½ä»¤
ğŸ‘‰ ä¸‹ä¸ªæœˆå¯èƒ½è¦åŠ ä¸ªfå‘½ä»¤
ğŸ‘‰ æ˜å¹´è¯´ä¸å®šè¦æ”¯æŒ1/2/3/4/5è¿™äº›æ•°å­—å‘½ä»¤

å¦‚æœç”¨è€æ–¹æ³•if-elseï¼š

- æ¯æ¬¡ä¿®æ”¹éƒ½è¦åœ¨å‡ ç™¾è¡Œä»£ç é‡Œæ‰¾å¯¹åº”çš„åˆ¤æ–­æ¡ä»¶
- åŠ ä¸€ä¸ªå‘½ä»¤å°±è¦æ–°å¢ä¸€ä¸ªifåˆ†æ”¯
- æ—¶é—´ä¹…äº†ä»£ç ä¼šå˜æˆè¶…é•¿çš„"é¢æ¡ä»£ç "

ç”¨äº†æ•°æ®åˆ†ç¦»çš„æ–°æ–¹æ³•åï¼š

- âœ¨ æ”¹éœ€æ±‚æ—¶åªéœ€è¦å…³æ³¨æ•°æ®éƒ¨åˆ†ï¼ˆé‚£ä¸ªå¯¹åº”å…³ç³»æ•°ç»„ï¼‰
- âœ¨ æ ¸å¿ƒä»£ç å®Œå…¨ä¸ç”¨åŠ¨
- â• åŠ å‘½ä»¤ï¼Ÿåœ¨æ•°ç»„é‡ŒåŠ ä¸€è¡Œå°±è¡Œ
- â– åˆ å‘½ä»¤ï¼Ÿç›´æ¥åˆ æ‰æ•°ç»„é‡Œé‚£è¡Œ
- ğŸ“‚ å¤„ç†å‡½æ•°å¤ªå¤§ï¼Ÿå¯ä»¥æ‹†åˆ°å•ç‹¬æ–‡ä»¶é‡Œ
- âŒ ç”šè‡³å¿˜è®°åˆ æ‰æ²¡ç”¨çš„å¤„ç†å‡½æ•°ä¹Ÿæ²¡å…³ç³»ï¼ˆä¸å½±å“è¿è¡Œï¼‰
